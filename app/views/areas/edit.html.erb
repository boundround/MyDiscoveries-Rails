<div class="edit-container">
  <h1>Edit <%= @area.display_name + ' (ID: ' + @area.id.to_s + ')' %></h1>
  <p>
    <a href="<%= area_path(@area) %>" target="blank">Preview</a>
  </p>
  <%= simple_form_for @area, html: { role: 'form'} do |f| %>
    <div class="about-content">
      <h3>About <%= @area.display_name %></h3>
      <% if current_user.has_role?("publisher") || current_user.has_role?("editor") || current_user.admin? %>
        <div class="form-group">
          <%= f.input :display_name, input_html: { class: 'form-control' } %>
        </div>
        <div class="form-group">
          <%= f.input :country, priority: ['Australia', 'United States of America'] %>
        </div>
        <div class="form-group">
          <%= f.input :description, as: :bootsy, label: false, input_html: { class: 'form-control area-description-input' } %>
        </div>
      <% end %>
      <% if current_user.has_role?("publisher") || current_user.try(:admin) %>
        <div class="form-group published-radio">
          <%= f.input :published_status, as: :radio_buttons, collection: ["draft", "edited", "live", "removed"] %>
        </div>
      <% elsif current_user.has_role?("editor") %>
        <% if @area.published_status == "draft" || @area.published_status == "edited" %>
          <div class="form-group published-radio">
            <%= f.input :published_status, as: :radio_buttons, collection: ["draft", "edited"] %>
          </div>
        <% else %>
        <div class="form-group published-radio">
          <%= f.input :published_status, as: :radio_buttons, collection: [@area.published_status] %>
        </div>
        <% end %>
      <% end %>
      <% if current_user.has_role?("publisher") || current_user.has_role?("editor") || current_user.admin? %>
        <p><input id="pac-input" class="controls" type="text"
            placeholder="Enter a location"></p>

        <div class="map-container">
          <div class="map-canvas"></div>
        </div>

        <div class="form-group lat-lng">
          <%= f.input :latitude, :input_html => { class: 'form-control', "data-geo" => "lat" } %>
          <%= f.input :longitude, :input_html => { class: 'form-control', "data-geo" => "lng" } %>
          <%= f.input :address, placeholder: 'Address', :input_html => { class: 'form-control', "data-geo" => "formatted_address" }, label: "Marker Address" %>
        </div>
        <div id="table-container">
      <h3>Videos</h3>
      <table class="table table-striped" id="video-table">
        <thead>
          <tr>
            <th>Preview</th>
            <th>Vimeo ID</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Include In Country</th>
            <th>Updated By</th>
            <th>Remove</th>
          </tr>
        </thead>
        <tbody>
          <% @area.videos.each do |video| %>
            <%= f.fields_for :videos do |ff| %>
              <tr>
                <%= ff.input :id, as: :hidden %>
                <td></td>
                <td><%= ff.text_area :vimeo_id %></td>
                <td><%= ff.select :priority, 1..10 %></td>
                <td><%= ff.select :status, ["draft", "edited", "live", "removed"] %></td>
                <td><%= ff.check_box :country_include %></td>
                <td><%= !video.versions.blank? && video.versions.last.whodunnit ? User.find(video.versions.last.whodunnit).email : "" %><br><%= video.updated_at.strftime('%F at %T') %></td>
                <td><%= ff.check_box :_destroy %></td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
    <div id="table-container">
      <h3>Photos</h3>
      <table class="table table-striped" id="photo-table">
        <thead>
          <tr>
            <th>Thumbnail</th>
            <th>Change Photo</th>
            <th>Credit</th>
            <th>Caption</th>
            <th>Alt Tags</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Include In Country</th>
            <th>Updated By</th>
            <th>Remove</th>
          </tr>
        </thead>
        <tbody>
          <% @area.photos.each do |photo| %>
            <%= f.fields_for :photos, photo do |ff| %>
              <tr>
                <%= ff.input :id, as: :hidden %>
                <td><img src="<%= asset_path(photo.path_url) %>" class="photo-edit-thumb"></td>
                <td><%= ff.file_field :path, class: "photo-file" %></td>
                <td><%= ff.text_area :credit %></td>
                <td class="photo-caption-edit"><%= ff.text_area :caption, :cols => "30", :rows => "5" %></td>
                <td><%= ff.text_field :alt_tag %></td>
                <td><%= ff.select :priority, 1..10 %></td>
                <td><%= ff.select :status, ["draft", "edited", "live", "removed"] %></td>
                <td><%= ff.check_box :country_include %></td>
                <td><%= !photo.versions.blank? && photo.versions.last.whodunnit ? User.find(photo.versions.last.whodunnit).email : "" %><br><%= photo.updated_at.strftime('%F at %T') %></td>
                <td><%= ff.check_box :_destroy %></td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
    <div id="table-container">
      <h3>Games</h3>
      <table class="table table-striped" id="game-table">
        <thead>
          <tr>
            <th>Thumbnail</th>
            <th>URL</th>
            <th>Game Type</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Updated By</th>
            <th>Remove</th>
          </tr>
        </thead>
        <tbody>
          <% @area.games.each do |game| %>
            <%= f.fields_for :games, game do |ff| %>
              <tr>
                <%= ff.input :id, as: :hidden %>
                <td><img src="<%= game_thumbnail(game) %>" class="photo-edit-thumb"></td>
                <td><%= ff.text_area :url, :cols => "50", :rows => "3" %></td>
                <td><%= ff.select :game_type, ["jigsaw puzzle", "word search", "slider"] %></td>
                <td><%= ff.select :priority, 1..10 %></td>
                <td><%= ff.select :status, ["draft", "edited", "live", "removed"] %></td>
                <td><%= !game.versions.blank? && game.versions.last.whodunnit ? User.find(game.versions.last.whodunnit).email : "" %><br><%= game.updated_at.strftime('%F at %T') %></td>
                <td><%= ff.check_box :_destroy %></td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
    <div id="table-container">
      <h3>Fun Facts</h3>
      <table class="table table-striped" id="fun-fact-table">
        <thead>
          <tr>
            <th>Content</th>
            <th>Reference</th>
            <th>Hero Photo</th>
            <th>Photo Credit</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Include In Country</th>
            <th>Updated By</th>
            <th>Remove</th>
          </tr>
        </thead>
        <tbody>
          <% @area.fun_facts.each do |fun_fact| %>
            <%= f.fields_for :fun_facts, fun_fact do |ff| %>
              <tr>
                <%= ff.input :id, as: :hidden %>
                <td><%= ff.text_field :content %></td>
                <td><%= ff.text_field :reference %></td>
                <td><%= ff.file_field :hero_photo %></td>
                <td><%= ff.text_field :photo_credit %></td>
                <td><%= ff.select :priority, 1..10 %></td>
                <td><%= ff.select :status, ["draft", "edited", "live", "removed"] %></td>
                <td><%= ff.check_box :country_include %></td>
                <td><%= !fun_fact.versions.blank? && fun_fact.versions.last.whodunnit ? User.find(fun_fact.versions.last.whodunnit).email : "" %><br><%= fun_fact.updated_at.strftime('%F at %T') %></td>
                <td><%= ff.check_box :_destroy %></td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
    <div id="table-container">
      <h3>Specials</h3>
      <table class="table table-striped" id="discount-table">
        <thead>
          <tr>
            <th>Description</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Include In Country</th>
            <th>Updated By</th>
            <th>Remove</th>
          </tr>
        </thead>
        <tbody>
          <% @area.discounts.each do |discount| %>
            <%= f.fields_for :discounts do |ff| %>
              <tr>
                <%= ff.input :id, as: :hidden %>
                <td><%= ff.bootsy_area :description %></td>
                <td><%= ff.select :priority, 1..10 %></td>
                <td><%= ff.select :status, ["draft", "edited", "live", "removed"] %></td>
                <td><%= ff.check_box :country_include %></td>
                <td><%= !discount.versions.blank? ? User.find(discount.versions.last.whodunnit).email : "" %><br><%= discount.updated_at.strftime('%F at %T') %></td>
                <td><%= ff.check_box :_destroy %></td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
    <div class="form-group">
      <%= f.button :submit, 'Update All' %>
    </div>
    <% end %>
  <% end %>

  <div class="edit_photo">
    <%= render "/videos/form" %>
  </div>

  <div class="edit_photo">
    <%= render "/photos/form" %>
  </div>

  <div class="edit_photo">
    <%= render "/discounts/form" %>
  </div>

  <div class="edit_photo">
    <%= render "/games/form" %>
  </div>

  <div class="edit_photo">
    <%= render "/fun_facts/form" %>
  </div>
</div>
<%= javascript_include_tag 'area.js' %>
