<div class="container">
  <% if @attraction.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@attraction.errors.count, "error") %> prohibited this attraction from being updated:</h2>

      <ul>
      <% @attraction.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  <% if user_signed_in? && (current_user.has_role?("publisher") || current_user.has_role?("editor") || current_user.admin?) %>
    <%= render "/attractions/admin_tabs" %>
    <h2>Edit <%= @attraction.display_name + ' (ID: ' + @attraction.id.to_s + ')' %></h2>

    <%= simple_form_for @attraction, html: { role: 'form'} do |f| %>
      <div class="row">
        <div class="col-md-6">
          <p><input id="pac-input" class="controls form-control" type="text"
              placeholder="Search For A Attraction">Geometry: <span id="latitude"><%= @attraction.latitude %></span>, <span id="longitude"><%= @attraction.longitude %></span></p>
          <div id="map-canvas" style="height:500px;"></div>
        </div>
        <div class="col-md-6">
          <div class="form-group lat-lng">
            <%= f.input :display_address, placeholder: 'Address', :input_html => { "data-geo" => "formatted_address", class: 'longer-input' }, label: "Display Address" %>
            <span class="pull-left"><%= f.input :latitude, :input_html => { "data-geo" => "lat" } %></span>
            <%= f.input :longitude, :input_html => { "data-geo" => "lng" } %>
            <%= f.input :street_number, :input_html => { "data-geo" => "street_number" } %>
            <span class="pull-left"><%= f.input :route, :input_html => { "data-geo" => "route", class: '' } %></span>
            <span class="pull-left"><%= f.input :sublocality, :input_html => { "data-geo" => "sublocality"} %></span>
            <%= f.input :locality, :input_html => { "data-geo" => "locality" } %>
            <span class="pull-left"><%= f.input :state, :input_html => { "data-geo" => "administrative_area_level_1" } %></span>
            <%= f.input :post_code, as: :string, :input_html => { "data-geo" => "postal_code" } %>
            <%= f.input :phone_number, input_html: { "data-geo" => "formatted_phone_number", class: 'form-control' } %>
            <%= f.input :place_id, input_html: { "data-geo" => "place_id", class: 'form-control' }, label: "Google Place ID" %>
            <%= f.input :trip_advisor_url, input_html: { class: 'form-control' } %>
          </div>
        </div>
      </div>
      <hr>
      <div>
          <%= f.check_box :footer_include, label: false %>&nbsp;Include In Footer?
      </div>
      <hr>
      <div class="form-group js-primary-category">
        <%= f.input :primary_category_id, as: :radio_buttons, :collection => @primary_categories, :item_wrapper_class => 'radio-inline', value_method: :id %>
      </div>
      <div class="form-group">
        <table class="table">
          <tr>
            <td>
          </tr>
        </table>
      </div>
      <div class="form-group">
        <%= f.input :display_name, input_html: { class: 'form-control' } %>
      </div>
      <div class="form-group">
        <%= f.association :country, label: 'Country', collection: @countries, as: :select, label_method: :display_name, required: true %>
      </div>
      <div class="form-group">
        <%= f.label "Parentable" %><br>
        <% if @attraction.parent.blank? %>
          <%= radio_button_tag 'parentable_chose', 'country', false %> Country &nbsp;&nbsp;
          <%= radio_button_tag 'parentable_chose', 'place', false %> Place &nbsp;&nbsp;
          <%= radio_button_tag 'parentable_chose', 'attraction', true %> Attraction
          <br>
          <%= f.fields_for :parent, (@attraction.childrens.new()) do |fc| %>
            <div id='chosen_country' style="display:none;">
              <%= fc.select(:parentable_id, @countries.collect {|p_c| [ p_c.display_name, p_c.id ] }, :required => true) %>
              <%= fc.hidden_field(:parentable_type, class: 'place_parent_attributes_parentable_type_country', value: "Country") %>
            </div>
            <div id='chosen_place' style="display:none;">
              <%= fc.select(:parentable_id, @places.collect {|p_c| [ p_c.display_name, p_c.id ] }, :required => true) %>
              <%= fc.hidden_field(:parentable_type, class: 'place_parent_attributes_parentable_type_place', value: "Place") %>  
            </div>
            <div id='chosen_attraction' style="display:none;">
              <%= fc.select(:parentable_id, @attractions.collect {|p_c| [ p_c.display_name, p_c.id ] }, :required => true) %>
              <%= fc.hidden_field(:parentable_type, class: 'place_parent_attributes_parentable_type_attraction', value: "Attraction") %>  
            </div>
          <% end %>
        <% else %>
          <%= radio_button_tag 'parentable_chose', 'country', (@attraction.parent.parentable_type.eql? 'Country') ? true : false %> Country &nbsp;&nbsp;
          <%= radio_button_tag 'parentable_chose', 'place', (@attraction.parent.parentable_type.eql? 'Place') ? true : false %> Place&nbsp;&nbsp;
          <%= radio_button_tag 'parentable_chose', 'attraction', (@attraction.parent.parentable_type.eql? 'Attraction') ? true : false %> Attraction
          <br>
          <%= f.fields_for :parent do |fc| %>
            <div id='chosen_country' style="display:none;">
              <%= fc.select(:parentable_id, @countries.collect {|p_c| [ p_c.display_name, p_c.id ] }, selected:  @attraction.parent.parentable_id) %>
              <%= fc.hidden_field(:parentable_type, class: 'place_parent_attributes_parentable_type_country', value: "Country") %>
            </div>
            <div id='chosen_place' style="display:none;">
              <%= fc.select(:parentable_id, @places.collect {|p_c| [ p_c.display_name, p_c.id ] }, selected:  @attraction.parent.parentable_id) %>
              <%= fc.hidden_field(:parentable_type, class: 'place_parent_attributes_parentable_type_place', value: "Place") %>
            </div>
            <div id='chosen_attraction' style="display:none;">
              <%= fc.select(:parentable_id, @attractions.collect {|p_c| [ p_c.display_name, p_c.id ] }, selected:  @attraction.parent.parentable_id) %>
              <%= fc.hidden_field(:parentable_type, class: 'place_parent_attributes_parentable_type_attraction', value: "Attraction") %>
            </div>
          <% end %>
        <% end %>
      </div>
      <div class="form-group">
        <%= f.input :short_description, label: "Meta Description (leave blank to auto-populate)", input_html: { class: 'form-control area-description-input' } %><br>
        <span id="shortDescriptionCharCount">0</span> characters entered. (255 max)<br>
      </div>
      <div class="form-group">
        <%= f.input :description, as: :bootsy, label: "Long description", input_html: { class: 'form-control area-description-input', col: 50 } %><br>
        <span id="descriptionCharCount">0</span> characters entered. (700 max)<br>
      </div>
      <div class="form-group">
        <%= f.input :email, input_html: { class: 'form-control' } %>
      </div>
      <div class="form-group">
        <%= f.input :website, input_html: { class: 'form-control' } %>
      </div>
      <% if current_user.has_role?("publisher") || current_user.try(:admin) %>
        <div class="form-group published-radio">
          <%= f.input :status, as: :select, collection: ["draft", "edited", "live", "removed"] %>
        </div>
      <% elsif current_user.has_role?("editor") %>
        <div class="form-group published-radio">
          <%= f.input :subscription_level, as: :radio_buttons, collection: ["basic", "standard", "Premium"] %>
        </div>
        <% if @attraction.status == "draft" || @attraction.status == "edited" %>
          <div class="form-group published-radio">
            <%= f.input :status, as: :radio_buttons, collection: ["draft", "edited"] %>
          </div>
        <% else %>
        <div class="form-group published-radio">
          <%= f.input :status, as: :radio_buttons, collection: [@attraction.status] %>
        </div>
        <% end %>
      <% end %>
      <div class="field row">
        <strong>Secondary categories</strong><br>
        <% @subcategories.each do |category| %>
            <% if category.category_type == "subcategory" %>
              <div class="checkbox-inline col-md-2">
                <%= hidden_field_tag "attraction[subcategory_ids][]", nil%>
                <%= check_box_tag "attraction[subcategory_ids][]", category.id, @attraction.subcategory_ids.include?(category.id), id: dom_id(category) %>
                <%= label_tag dom_id(category), category.name %>
              </div>
          <% end %>
        <% end %>
      </div>
      <div class="form-group">
        <br>
        <strong>Age Range</strong>
        <%= f.input :minimum_age, collection: 0..18, label: "From:", input_html: { class: 'form-control' } %>
        <%= f.input :maximum_age, collection: 0..18, label: "To:", input_html: { class: 'form-control' } %>
      </div>
      <div class="field js-primary-category row">
        <br>
        <strong>Price categories</strong><br>
        <% @subcategories.each do |category| %>
            <% if category.category_type == "price" %>
              <div class="checkbox-inline col-md-2">
                <%= hidden_field_tag "attraction[subcategory_ids][]", nil%>
                <%= check_box_tag "attraction[subcategory_ids][]", category.id, @attraction.subcategory_ids.include?(category.id), id: dom_id(category) %>
                <%= label_tag dom_id(category), category.name %>
              </div>
          <% end %>
        <% end %>
      </div>
      <div class="field js-primary-category row">
        <br>
        <strong>Accessibility</strong><br>
        <% @subcategories.each do |category| %>
            <% if category.category_type == "accessibility" %>
            <div class="checkbox-inline col-md-2">
              <%= hidden_field_tag "attraction[subcategory_ids][]", nil%>
              <%= check_box_tag "attraction[subcategory_ids][]", category.id, @attraction.subcategory_ids.include?(category.id), id: dom_id(category) %>
              <%= label_tag dom_id(category), category.name %>
            </div>
          <% end %>
        <% end %>
      </div>
      <div class="field js-primary-category row">
        <br>
        <strong>Attraction visit duration</strong><br>
        <% @subcategories.each do |category| %>
            <% if category.category_type == "duration" %>
            <div class="checkbox-inline col-md-2">
              <%= hidden_field_tag "attraction[subcategory_ids][]", nil%>
              <%= check_box_tag "attraction[subcategory_ids][]", category.id, @attraction.subcategory_ids.include?(category.id), id: dom_id(category) %>
              <%= label_tag dom_id(category), category.name %>
            </div>
          <% end %>
        <% end %>
      </div>
      <div class="field js-primary-category row">
        <br>
        <strong>Best time of day</strong><br>
        <% @subcategories.each do |category| %>
            <% if category.category_type == "optimum_time" %>
            <div class="checkbox-inline col-md-2">
              <%= hidden_field_tag "attraction[subcategory_ids][]", nil%>
              <%= check_box_tag "attraction[subcategory_ids][]", category.id, @attraction.subcategory_ids.include?(category.id), id: dom_id(category) %>
              <%= label_tag dom_id(category), category.name %>
            </div>
          <% end %>
        <% end %>
      </div>
      <div class="field js-primary-category">
        <br>
        <strong>Weather Conditions</strong><br>
        <% @subcategories.each do |category| %>
            <% if category.category_type == "weather" %>
            <%= hidden_field_tag "attraction[subcategory_ids][]", nil%>
            <%= check_box_tag "attraction[subcategory_ids][]", category.id, @attraction.subcategory_ids.include?(category.id), id: dom_id(category) %>
            <%= label_tag dom_id(category), category.name %><br/>
          <% end %>
        <% end %>
      </div>
      <div class="form-group js-primary-category">
        <br>
        <input type="checkbox" id="special-requirements-box">&nbsp;&nbsp;<strong>Special requirements?</strong> (Unchecking will delete text)
        <div class="js-special-requirements">
          <%= f.input :special_requirements, label: false, input_html: { class: 'form-control' } %>
        </div>
      </div>
      <div class="form-group">
        <%= f.button :submit, 'Submit' %>
      </div>
    <% end %>
    <hr>
  <% else %>
    <h2>You do not have sufficient privileges to view this page</h2>
    <%= link_to "Home", root_path %>
  <% end %>
  <p></p>
  <br>
  <p></p>
</div>
