<!DOCTYPE html>
<html lang="en" ng-App="boundRound">
<% if not @placeprograms %>
	<head>
	  <title><%= full_title(yield(:title)) %></title>

	  <%= stylesheet_link_tag( 'application', media: 'all') %>
		<!--%= @set_css ? stylesheet_link_tag(@set_css) : stylesheet_link_tag("br/custom.css") %-->
	  <%= csrf_meta_tags %>

	  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	  <link href='//fonts.googleapis.com/css?family=Signika:300,400,600,700' rel='stylesheet' type='text/css'>
	  <link href='//fonts.googleapis.com/css?family=Handlee' rel='stylesheet' type='text/css'>

	 <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	 <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	 <!--[if lt IE 9]>
	   <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	   <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	 <![endif]-->

		<link rel="apple-touch-icon" sizes="57x57" href="<%= asset_path('favicons/apple-touch-icon-57x57.png')%>"
		<link rel="apple-touch-icon" sizes="60x60" href="<%= asset_path('favicons/apple-touch-icon-60x60.png')%>"
		<link rel="apple-touch-icon" sizes="72x72" href="<%= asset_path('favicons/apple-touch-icon-72x72.png')%>"
		<link rel="apple-touch-icon" sizes="76x76" href="<%= asset_path('favicons/apple-touch-icon-76x76.png')%>"
		<link rel="apple-touch-icon" sizes="114x114" href="<%= asset_path('favicons/apple-touch-icon-114x114.png')%>"
		<link rel="apple-touch-icon" sizes="120x120" href="<%= asset_path('favicons/apple-touch-icon-120x120.png')%>"
		<link rel="apple-touch-icon" sizes="144x144" href="<%= asset_path('favicons/apple-touch-icon-144x144.png')%>"
		<link rel="icon" type="image/png" href="<%= asset_path('favicons/favicon-32x32.png')%>" sizes="32x32">
		<link rel="icon" type="image/png" href="<%= asset_path('favicons/favicon-96x96.png')%>" sizes="96x96">
		<link rel="icon" type="image/png" href="<%= asset_path('favicons/favicon-16x16.png')%>" sizes="16x16">
		<link rel="manifest" href="<%= asset_path('favicons/manifest.json')%>"
		<meta name="msapplication-TileColor" content="#da532c">
		<meta name="msapplication-TileImage" content="<%= asset_path('favicons/mstile-144x144.png')%>"
		<meta name="theme-color" content="#ffffff">

	  <meta name="viewport" content="width=device-width,
	                                     initial-scale=1.0,
	                                     maximum-scale=1.0,
	                                     user-scalable=no">
	  <%= raw open_graph_image %>
	  <%= render "/layouts/ga" %>

    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            /*background-color: black;*/
        }

        #home-map-wrapper,
        #home-map {
            height: 100%;
            width: 100%;
            position: absolute;
        }
        /*.blur {
        opacity: .5; -webkit-filter: blur(5px); -moz-filter: blur(5px); -o-filter: blur(5px); -ms-filter: blur(5px); filter: blur(5px);
      }*/

        #info-box {
            background-color: white;
            border: 1px solid black;
            top: 30px;
            height: 200px;
            padding: 10px;
            position: absolute;
            right: 30px;
        }

        .home-map-wrapper .overlay {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 9;
            display: block;
            top: 0;
            left: 0;
            z-index: 000;
            opacity: 0;
        }

        .home-map-wrapper.enabled .overlay {
            display: none;
        }

        .no-bg {
            background: transparent !important;
        }
    </style>

	</head>

	<body class="<%= @set_body_class ? @set_body_class : 'homepage' %>">
		<%= javascript_include_tag 'mapbox' %>
    <%= javascript_include_tag 'application' %>
    <script src="//ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script src="//maps.googleapis.com/maps/api/js?sensor=false&amp;libraries=places"></script>
    <%= javascript_include_tag 'froogaloop' %>
    <script src="//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
    <script src="//cdn.jsdelivr.net/algoliasearch.helper/2/algoliasearch.helper.min.js"></script>
    <script src="//cdn.jsdelivr.net/hogan.js/3.0.2/hogan.min.common.js"></script>



		<div id="place-holder"></div>
	  <%= render "/layouts/page_loader" %>
	  <% flash.each do |type, message| %>
		  <div class="alert <%= bootstrap_class_for(type) %> fade in">
		    <button class="close" data-dismiss="alert">Ã—</button>
		    <%= message %>
		  </div>
		<% end %>
		<div class="alert-wrapper"></div>

		<%= render "/layouts/admin_menu" %>

	  <div class="app-wrap">
	    <%= yield %>
	  </div>
	  <%= render "/layouts/signin_modals" %>

	  <%= render "/layouts/share_modal" %>

    <script>
      var APPLICATION_ID = 'KXOYK344AM';
      var SEARCH_ONLY_API_KEY = 'fce29aca7a9b823b9cacdbc1faa225e2';
      var INDEX_NAME = 'place';
      var PARAMS = {
        hitsPerPage: 6,
        maxValuesPerFacet: 8,
      };

      var algolia = algoliasearch(APPLICATION_ID, SEARCH_ONLY_API_KEY);
      var algoliaHelper = algoliasearchHelper(algolia, INDEX_NAME, PARAMS);

      $searchInput = $('#search-box');
      $searchInputIcon = $('#search-button');
      $main = $('main');
      $sortBySelect = $('#sort-by-select');
      $hits = $('#hits');
      $stats = $('#stats');
      $facets = $('#facets');
      $pagination = $('#pagination');

      var hitTemplate = Hogan.compile($('#hit-template').text());
      var statsTemplate = Hogan.compile($('#stats-template').text());
      var facetTemplate = Hogan.compile($('#facet-template').text());
      var sliderTemplate = Hogan.compile($('#slider-template').text());
      var paginationTemplate = Hogan.compile($('#pagination-template').text());
      var noResultsTemplate = Hogan.compile($('#no-results-template').text());

      $searchInput
      .on('keyup', function() {
        var query = $(this).val();
        console.log(query);
        if (query.length > 0){
          $('#hits').show();
          $('#stats').show();
          algoliaHelper.setQuery(query);
          algoliaHelper.search();
        } else {
          $('#hits').hide();
          $('#stats').hide();
        }
      })
      .focus();

      // Search results
      algoliaHelper.on('result', function(content, state) {
        console.log(content);
        renderHits(content);
        renderStats(content)
      });

      function renderHits(content) {
        console.log("rendering hits");
        $hits.html(hitTemplate.render(content));
      }

      function renderStats(content) {
        var stats = {
          nbHits: content.nbHits,
          nbHits_plural: content.nbHits !== 1,
          processingTimeMS: content.processingTimeMS
        };
        $stats.html(statsTemplate.render(stats));
      }

      // NO RESULTS
      // ==========

      function handleNoResults(content) {
        if (content.nbHits > 0) {
          $main.removeClass('no-results');
          return;
        }
        $main.addClass('no-results');

        var filters = [];
        var i;
        var j;
        for (i in algoliaHelper.state.facetsRefinements) {
          filters.push({
            class: 'toggle-refine',
            facet: i, facet_value: algoliaHelper.state.facetsRefinements[i],
            label: FACETS_LABELS[i] + ': ',
            label_value: algoliaHelper.state.facetsRefinements[i]
          });
        }
        for (i in algoliaHelper.state.disjunctiveFacetsRefinements) {
          for (j in algoliaHelper.state.disjunctiveFacetsRefinements[i]) {
            filters.push({
              class: 'toggle-refine',
              facet: i,
              facet_value: algoliaHelper.state.disjunctiveFacetsRefinements[i][j],
              label: FACETS_LABELS[i] + ': ',
              label_value: algoliaHelper.state.disjunctiveFacetsRefinements[i][j]
            });
          }
        }
        for (i in algoliaHelper.state.numericRefinements) {
          for (j in algoliaHelper.state.numericRefinements[i]) {
            filters.push({
              class: 'remove-numeric-refine',
              facet: i,
              facet_value: j,
              label: FACETS_LABELS[i] + ' ',
              label_value: j + ' ' + algoliaHelper.state.numericRefinements[i][j]
            });
          }
        }
        $hits.html(noResultsTemplate.render({query: content.query, filters: filters}));
      }

      $(document).on('click', '.go-to-page', function(e) {
        e.preventDefault();
        $('html, body').animate({scrollTop: 0}, '500', 'swing');
        algoliaHelper.setCurrentPage(+$(this).data('page') - 1).search();
      });

      $('#hits').on('click', ".hit", function(){window.location = $(this).data("url")});

    </script>
	</body>



<% elsif @placeprograms %>

	    <%= yield %>

<% end %>
</html>
