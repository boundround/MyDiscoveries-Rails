<div class="booking-block">
  <div class="width-limiter">
    <div class="passenger-details-block wrapper-block" id="<%= action_name %>-<%= controller_name %>">
      <aside>
        <div class="booking-info">
          <div class="bi-top">
              <h3 class="point-card__header">
                <%= offer.locationStart %>
              </h3>
              <p class="bit-hotel">
                <%= offer.name %>
              </p>
              <div class="bit-info">
               <h4 class="heading">your booking:</h4>
                <ul>
                  <li>
                    <%= line_items.pluck(:quantity).reduce(:+) %> guests
                  </li>
                  <li>
                    <%= create_duration(offer) %>
                  </li>
                </ul>
              </div>
            </div>
            <div class="bi-bottom">
              <table>
                <% line_items.each do |line_item| %>
                  <tr>
                    <td><%= "#{line_item.variant.select_label} (Qty: #{line_item.quantity})" %></td>
                    <td>
                      <% if line_item.request_installments? %>
                        <%= "5 x #{number_to_currency(total_line_item_price(line_item).to_f / 5.to_f)}" %>
                      <% else %>
                        <%= "#{number_to_currency(total_line_item_price(line_item))}" %>
                      <% end %>
                    </td>
                  </tr>
                <% end %>
                <tr>
                  <td>Total price</td>
                  <td>
                    $<%= total_line_items_price(line_items) %>
                  </td>
                </tr>
              </table>
              <div class="bib-cards">
                <%= image_tag('offer/i/booking/cards.png', alt: 'creditcards') %>
              </div>
            </div>
          </div>
        </aside>
        <section class="passenger-details">
          <div class="pdb-header">
            <h1 class="lars">Passenger details</h1>
          </div>

          <div class="passenger-info-block">
            <%= simple_form_for(order, url: update_passengers_offer_order_path(offer, order), method: :patch, html: { class: 'horizontal' }) do |of| %>
              <% @order.passengers.each_with_index do |passenger, n| %>
                <%= of.simple_fields_for :passengers, passenger do |pf| %>
                <%= pf.input :line_item_id, as: :hidden %>
                  <div class="passanger-info-item">
                    <h4 class="heading">
                      PASSENGER DETAILS
                      <%= "##{n + 1}"%>
                    </h4>
                    <div class="form-block">
                      <div class="form-group sm">
                        <%= pf.label :title, 'Title' %>
                        <%= pf.input :title,
                          as: :select,
                          collection: Passenger::TITLES,
                          include_blank: false,
                          label: false,
                          selected: n > 0 ? "" : @user.gender,
                          input_html: {
                            class: "select optional form-control select2-hidden-accessible",
                          }
                        %>
                      </div>
                      <div class="form-group sm">
                        <%= pf.label :first_name, 'First Name' %>
                        <%= pf.input :first_name,
                          placeholder: 'Jane',
                          label: false,
                          required: true,
                          input_html: {
                             value: n > 0 ? "" : @user.first_name
                          }
                        %>
                      </div>
                      <div class="form-group sm">
                        <%= pf.label :last_name, 'Last Name' %>
                        <%= pf.input :last_name,
                          placeholder: 'Smith',
                          label: false,
                          required: true,
                          input_html: {
                             value: n > 0 ? "" : @user.last_name
                          }
                        %>
                      </div>
                      <div class="form-group sm">
                        <%= pf.label :date_of_birth, 'Date of birth' %>
                        <%= pf.input :date_of_birth,
                          as: :date,
                          html5: true,
                          label: false,
                          required: true,
                          input_html: {
                             value: n > 0 ? "" : @user.date_of_birth
                          }
                        %>
                      </div>
                      <% unless n > 0 %>
                        <div class="form-group sm">
                          <%= pf.label :telephone, 'Telephone' %>
                          <%= pf.input :telephone,
                            placeholder: '',
                            as: :tel,
                            label: false,
                            input_html: {
                               value: @user.home_phone
                            }
                          %>
                        </div>
                        <div class="form-group sm">
                          <%= pf.label :mobile, 'Mobile' %>
                          <%= pf.input :mobile,
                            placeholder: '+61',
                            as: :tel,
                            label: false,
                            input_html: {
                               value: @user.mobile
                            }
                          %>
                        </div>
                        <div class="form-group sm">
                          <%= pf.label :email, 'Email' %>
                          <%= pf.input :email,
                            placeholder: 'your@mail.com',
                            as: :email,
                            label: false,
                            input_html: {
                               value: @user.email
                            }
                          %>
                        </div>
                      <% end %>
                    </div>
                  </div>
                <% end %>
              <% end %>
            </div>

            <div class="btns-block">
              <%= link_to 'back', add_offer_orders_path(offer), class: 'btn-bordered red no-border' %>
              <%= button_tag(type: 'submit', class: 'btn-bordered red invert') do %>
                <span>CONTINUE</span>
              <% end %>
            </div>
          <% end %>
        </section>
    </div>
  </div>
</div>
