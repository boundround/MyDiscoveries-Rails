var version="1.4.1",language=window.navigator.userLanguage||window.navigator.language,canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),$canvas=$("canvas"),$ctnest=$("#ctnest"),imagepackN=0,NUM=3,hintMovePenalty=5,hintTimePenalty=10,fullImageMovePenalty=10,fullImageTimePenalty=15,imagecount=23,src=-1,dst=-1,place=[],animation=!0,grid=!0,swapped=!1,hint=!1,once=!1,swapHint=!1,customGame=!1,lost=!1,swipe=!0,newHigh=!1,cWon=!1,timerStarted,Config,HEIGHT,WIDTH,PORTRAIT,BSIZE,mode,animIcon,
showfullIcon,hintIcon,swapIcon,gridIcon,imageOn="b",imageOff="w",alertM,videopuzzle,video,parentOffsetLeft=0,parentOffsetTop=0,x,fakeNeighS,fakeNeighD,cx,cy,imageW,imageH,kepW,kepH,ratio,SIZEX,SIZEY,scaledW,swaps,sourceRect,destinationRect,sourceImage,destinationImage,imageStroke,available_version,animoldicon,animold,hours=0,minutes=0,msecs=0,seconds=0,moves=0,animv,packN,getScore,setScore,selectedImage,gamemode,maxW,activePage,videoendloop,inGameButtons,kep=new Image,packIcon,openIcon,nextIcon,infoIcon,
loadingS=!0,hover,myT,MyD,delay=0,loadingP=0,loadingL=0,mousePos,imageNumX=6,imageNumY=4,imageSizeW,imageSizeH,images,imagepacks,switchIcon="l",modeshow="classic",videoloop,LANG_LOADING,confLoaded=!1,isFullImgHint=!1,packPage,lostPage,classiciPage,challengeiPage,funiPage,infoPage,newGamePage,fullImagePage,imageSelectedPage,messagePage,imagePage,sizePage,mainPage,myD,generateVariables,loadjs,keveres,getXYD,getXYS,getN,isInt,scoreCallback,isWon,isEnd,scores,neighbors,drawHint,repaint,repaint2,startPuzzle,
isTouchDevice,myTimer,move,setNUM,selectImage,versionCheck,loadAll,loading,handleFileSelect,myDelay,getMousePos,onloadImg,langLoad,confLoad,winCallback,language=language.split("-",1)[0];generateVariables=function(){var a;for(a=0;24>a;a++)window["pack"+a+"A"]=!1};generateVariables();
loadjs=function(a,b,c){var d=!1,e=document.createElement("script");loadjs.handleLoad=function(){d||(console.log('Note: "'+a+'" is loaded sucessfully!'),d=!0,c&&c(a,"ok"))};loadjs.handleReadyStateChange=function(){var a;d||(a=e.readyState,"complete"===a&&loadjs.handleLoad())};loadjs.handleError=function(){d||(console.error('Error: "'+a+'" is not loaded!'),d=!0,c&&c(a,"error"))};e.type="text/javascript";e.onload=loadjs.handleLoad;e.onreadystatechange=loadjs.handleReadyStateChange;e.onerror=loadjs.handleError;
e.src=a;""!==b&&(e.id=b);document.head.appendChild(e)};keveres=function(){var a,b,c;for(c=0;c<place.length;c++)a=Math.floor(Math.random()*place.length),b=place[c],place[c]=place[a],place[a]=b,isEnd()&&keveres()};getXYD=function(a){return{x:a%NUM*SIZEX,y:Math.floor(a/NUM)*SIZEY}};getXYS=function(a){return{x:a%NUM*imageW,y:Math.floor(a/NUM)*imageH}};getN=function(a,b){return Math.floor(b/SIZEY)*NUM+Math.floor(a/SIZEX)};isInt=function(a){return parseFloat(a)===parseInt(a,10)&&!isNaN(a)};
scoreCallback=function(){return{hours:setScore[0],minutes:setScore[1],seconds:setScore[2],moves:setScore[3]}};isWon=function(){return!0===cWon?(getScore=scoreCallback(),!0):!1};
scores=function(){if(!customGame){setScore=[];setScore[0]=hours;setScore[1]=minutes;setScore[2]=seconds;setScore[3]=moves;var a=localStorage.getItem(packN+"_"+selectedImage+"_"+NUM+"_"+gamemode+"_moves"),b=localStorage.getItem(packN+"_"+selectedImage+"_"+NUM+"_"+gamemode+"_time"),c=3600*hours+60*minutes+seconds,d,e;b&&(d=b.split(":")[0],e=b.split(":")[1],b=b.split(":")[2],d=3600*d+60*e+b);a||("classic"===gamemode&&a>moves?(localStorage.setItem(packN+"_"+selectedImage+"_"+NUM+"_"+gamemode+"_moves",
moves),localStorage.setItem(packN+"_"+selectedImage+"_"+NUM+"_"+gamemode+"_time",hours+":"+minutes+":"+seconds),newHigh=!0):"classic"===gamemode&&a===moves&&d>c?(localStorage.setItem(packN+"_"+selectedImage+"_"+NUM+"_"+gamemode+"_moves",moves),localStorage.setItem(packN+"_"+selectedImage+"_"+NUM+"_"+gamemode+"_time",hours+":"+minutes+":"+seconds),newHigh=!0):"challenge"===gamemode&&d<c?(localStorage.setItem(packN+"_"+selectedImage+"_"+NUM+"_"+gamemode+"_moves",moves),localStorage.setItem(packN+"_"+
selectedImage+"_"+NUM+"_"+gamemode+"_time",hours+":"+minutes+":"+seconds),newHigh=!0):"challenge"===gamemode&&d===c&&a>moves?(localStorage.setItem(packN+"_"+selectedImage+"_"+NUM+"_"+gamemode+"_moves",moves),localStorage.setItem(packN+"_"+selectedImage+"_"+NUM+"_"+gamemode+"_time",hours+":"+minutes+":"+seconds),newHigh=!0):"fun"===gamemode&&a>moves?(localStorage.setItem(packN+"_"+selectedImage+"_"+NUM+"_"+gamemode+"_moves",moves),localStorage.setItem(packN+"_"+selectedImage+"_"+NUM+"_"+gamemode+"_time",
hours+":"+minutes+":"+seconds),newHigh=!0):"fun"===gamemode&&a===moves&&d>c&&(localStorage.setItem(packN+"_"+selectedImage+"_"+NUM+"_"+gamemode+"_moves",moves),localStorage.setItem(packN+"_"+selectedImage+"_"+NUM+"_"+gamemode+"_time",hours+":"+minutes+":"+seconds),newHigh=!0))}};
neighbors=function(a,b){var c,d;if(swapHint)return!0;if(swipe){if(0===(b-a)%NUM)return fakeNeighS=a,fakeNeighD=a<b?a+NUM:a-NUM,!0;c=a%NUM;d=NUM-(c+1);a>b?a-b<=c&&(fakeNeighS=a,fakeNeighD=a-1):b-a<=d&&(fakeNeighS=a,fakeNeighD=a+1);return!0}c=Math.min(a,b);d=Math.max(a,b);return c+NUM===d?!0:c%NUM+1===d%NUM&&d-c!==NUM+1&&6>d-c};isEnd=function(){var a;for(a=0;a<place.length;a++)if(place[a]!==a)return!1;return!0};
drawHint=function(){var a,b;for(b=0;b<place.length;b++)b<NUM&&(a=place.indexOf(b),ctx.fillStyle="#ffff00",ctx.fillRect(getXYD(a).x,getXYD(a).y,SIZEX,.05*SIZEY)),0===(b+1)%NUM&&(a=place.indexOf(b),ctx.fillStyle="#00ff00",ctx.fillRect(getXYD(a).x+.95*SIZEX,getXYD(a).y,.05*SIZEX,SIZEY)),0===b%NUM&&(a=place.indexOf(b),ctx.fillStyle="#0000ff",ctx.fillRect(getXYD(a).x,getXYD(a).y,.05*SIZEX,SIZEY)),NUM*(NUM-1)<b+1&&(a=place.indexOf(b),ctx.fillStyle="#ff0000",ctx.fillRect(getXYD(a).x,getXYD(a).y+.95*SIZEY,
SIZEX,.05*SIZEY))};repaint2=function(){var a=new Menu,b;for(b=0;b<place.length;b++)a.add(new MyImageItem(b,kep,getXYS(place[b]).x,getXYS(place[b]).y,imageW,imageH,getXYD(b).x,getXYD(b).y,SIZEX,SIZEY));a.draw();!0===hint&&drawHint();!0!==grid||videopuzzle||(imageStroke=new MyGridItem("grid",0,0,scaledW,HEIGHT,NUM,NUM),imageStroke.draw())};
repaint=function(){var a,b;if(!1===animation||!0===alertM){ctx.clearRect(0,0,scaledW,HEIGHT);a=new Menu;for(b=0;b<place.length;b++)a.add(new MyImageItem(b,kep,getXYS(place[b]).x,getXYS(place[b]).y,imageW,imageH,getXYD(b).x,getXYD(b).y,SIZEX,SIZEY));a.draw();!0===hint&&drawHint();!0!==grid||videopuzzle||(imageStroke=new MyGridItem("grid",0,0,scaledW,HEIGHT,NUM,NUM),imageStroke.draw());showfullIcon=imageOff}a=new Menu;Config.simpleMode||(ctx.clearRect(WIDTH-.15*WIDTH,.07*HEIGHT,.15*WIDTH,.08*HEIGHT),
a.add(new MyTextItem("movesn",moves,WIDTH-10,.1*HEIGHT,.05*HEIGHT,0,"right")),a.draw());!0===animation&&(destinationImage&&(sourceRect.draw(),destinationRect.draw(),destinationImage.draw()),sourceImage&&sourceImage.draw());"classic"===mode&&(animIcon=animoldicon);isEnd()&&!videopuzzle&&ctx.drawImage(kep,0,0,scaledW,HEIGHT);Config.simpleMode||timerStarted||(a=new MyTextItem("timer",minutes+":"+seconds,WIDTH-10,.04*HEIGHT,.05*HEIGHT,0,"right"),a.draw())};
function buttonRepaint(){Config.simpleMode||(inGameButtons=new Menu,inGameButtons.add(new ImageMenuItem("hint","images/hint_"+hintIcon+".png",WIDTH-1.2*BSIZE,.2*HEIGHT-BSIZE/2,BSIZE,BSIZE,0)),inGameButtons.add(new ImageMenuItem("timer","",.9*WIDTH,0,.1*WIDTH,.1*HEIGHT,0)),"classic"===mode?inGameButtons.add(new ImageMenuItem("swap","images/swap_"+swapIcon+".png",WIDTH-1.2*BSIZE,.35*HEIGHT-BSIZE/2,BSIZE,BSIZE,0,0,swaps)):inGameButtons.add(new ImageMenuItem("swap","images/swap_"+swapIcon+".png",WIDTH-
1.2*BSIZE,.35*HEIGHT-BSIZE/2,BSIZE,BSIZE,0)),inGameButtons.add(new ImageMenuItem("showfull","images/full_"+showfullIcon+".png",WIDTH-1.2*BSIZE,.5*HEIGHT-BSIZE/2,BSIZE,BSIZE,0)),inGameButtons.add(new ImageMenuItem("grid","images/grid_"+gridIcon+".png",WIDTH-1.2*BSIZE,.65*HEIGHT-BSIZE/2,BSIZE,BSIZE,0)),0===parseInt(Config.quickMode,10)&&inGameButtons.add(new ImageMenuItem("back","images/back_"+imageOn+".png",WIDTH-1.2*BSIZE,HEIGHT-1.2*BSIZE,BSIZE,BSIZE,0)),0!==parseInt(Config.quickMode,10)&&Config.nextButton&&
inGameButtons.add(new ImageMenuItem("nextimg","images/nextimg_"+imageOn+".png",WIDTH-1.2*BSIZE,HEIGHT-1.2*BSIZE,BSIZE,BSIZE,0)),inGameButtons.draw())}
startPuzzle=function(a){var b,c;newHigh=cWon=!1;0!==parseInt(Config.quickMode,10)?videopuzzle&&video.addEventListener("canplay",function(){animation=!1;$("#video").get(0).play()}):videopuzzle&&(animation=!1,$("#video").get(0).play());startPuzzle.mode=a;"challenge"===a&&(gamemode="challenge",2===NUM&&(msecs=100,seconds=2,minutes=0),3===NUM&&(msecs=100,seconds=15,minutes=0),4===NUM&&(msecs=100,seconds=35,minutes=0),5===NUM&&(msecs=100,seconds=20,minutes=1),6===NUM&&(msecs=100,seconds=40,minutes=2),
7===NUM&&(msecs=100,seconds=40,minutes=4),8===NUM&&(msecs=100,seconds=30,minutes=7),9===NUM&&(msecs=100,seconds=30,minutes=9));"classic"===a&&(gamemode="classic",swaps=NUM-2);"fun"===a&&(gamemode="fun",swaps=1);maxW=.8*WIDTH;Config.simpleMode&&(maxW=WIDTH);animoldicon=animIcon;animold=animation;moves=0;ctx.clearRect(0,0,WIDTH,HEIGHT);sourceImage=destinationImage=null;dst=src=-1;place=[];for(c=0;c<NUM*NUM;c++)place[c]=c;keveres();if(0!==parseInt(Config.quickMode,10))videopuzzle&&video.addEventListener("canplay",
function(){imageW=video.videoWidth/NUM;imageH=video.videoHeight/NUM;kepW=Math.max(video.videoWidth,video.videoHeight);kepH=Math.min(video.videoWidth,video.videoHeight);ratio=kepW/kepH;scaledW=HEIGHT*ratio;Config.simpleMode&&(scaledW=maxW);maxW<scaledW&&(scaledW=maxW);SIZEX=scaledW/NUM;SIZEY=HEIGHT/NUM}),videopuzzle||(kep.onload=function(){imageW=kep.width/NUM;imageH=kep.height/NUM;kepW=Math.max(kep.width,kep.height);kepH=Math.min(kep.width,kep.height);ratio=kepW/kepH;scaledW=HEIGHT*ratio;Config.simpleMode&&
(scaledW=maxW);maxW<scaledW&&(scaledW=maxW);SIZEX=scaledW/NUM;SIZEY=HEIGHT/NUM;if(!0===animation){b=new Menu;for(c=0;c<NUM*NUM;c++)b.add(new MyImageItem(c,kep,getXYS(place[c]).x,getXYS(place[c]).y,imageW,imageH,getXYD(c).x,getXYD(c).y,SIZEX,SIZEY));b.draw();!0===hint&&drawHint();!0!==grid||videopuzzle||(imageStroke=new MyGridItem("grid",0,0,scaledW,HEIGHT,NUM,NUM),imageStroke.draw())}});else if(videopuzzle&&(imageW=video.videoWidth/NUM,imageH=video.videoHeight/NUM,kepW=Math.max(video.videoWidth,video.videoHeight),
kepH=Math.min(video.videoWidth,video.videoHeight)),videopuzzle||(imageW=kep.width/NUM,imageH=kep.height/NUM,kepW=Math.max(kep.width,kep.height),kepH=Math.min(kep.width,kep.height)),ratio=kepW/kepH,scaledW=HEIGHT*ratio,Config.simpleMode&&(scaledW=maxW),maxW<scaledW&&(scaledW=maxW),SIZEX=scaledW/NUM,SIZEY=HEIGHT/NUM,!0===animation){b=new Menu;for(c=0;c<NUM*NUM;c++)b.add(new MyImageItem(c,kep,getXYS(place[c]).x,getXYS(place[c]).y,imageW,imageH,getXYD(c).x,getXYD(c).y,SIZEX,SIZEY));b.draw();!0===hint&&
drawHint();!0!==grid||videopuzzle||(imageStroke=new MyGridItem("grid",0,0,scaledW,HEIGHT,NUM,NUM),imageStroke.draw())}0!==parseInt(Config.quickMode,10)?videopuzzle?video.addEventListener("canplay",function(){repaint();buttonRepaint()}):(repaint(),buttonRepaint()):(repaint(),buttonRepaint());$canvas.unbind("click");$canvas.bind("click",function(a){"game"!==activePage||clickCheck(a)})};setNUM=function(a){NUM=parseInt(a,10)};
selectImage=function(a){videopuzzle?($("video").get(0).pause(),$("#videosrc").attr("src",a),$("video").get(0).load()):kep.src=a};
versionCheck=function(){if(available_version){var a=version.split(".")[0],b=version.split(".")[1],c=version.split(".")[2],a=100*a+10*b+c,b=available_version.split(".")[0],c=available_version.split(".")[1],d=available_version.split(".")[2];parseInt(100*b+10*c+d,10)>parseInt(a,10)&&alert("New version available!\n\nAvailable Version: "+available_version+"\nYour Version: "+version+"\nDownload new version from: CodeCanyon.net")}};
loadAll=function(a){var b=ctx.createLinearGradient(0,.45*HEIGHT,0,.55*HEIGHT);loadAll.onloadImg=function(){loadingL+=.8*WIDTH/imagecount;loadingP+=1;ctx.clearRect(0,0,WIDTH,HEIGHT);ctx.fillRect(.1*WIDTH,.45*HEIGHT,loadingL,.1*HEIGHT);ctx.strokeRect(.1*WIDTH,.45*HEIGHT,.8*WIDTH,.1*HEIGHT);ctx.fillStyle="rgba("+Config.foreGround+",1)";ctx.fillText(LANG_LOADING,WIDTH/2,HEIGHT/2);ctx.fillStyle=b;loadingP===imagecount&&mainPage.firstLoad()};if(LANG_LOADING)if(void 0!==window["Pack"+a]&&(imagecount=window["Pack"+
a].size),$("#ctnest").css("background","rgba("+Config.backGround+",1)"),videopuzzle)mainPage.draw();else{ctx.strokeStyle="rgba("+Config.foreGround+",1)";b.addColorStop(0,"rgba("+Config.color+",1)");b.addColorStop(1,"rgba("+Config.color2+",1)");ctx.fillStyle=b;ctx.font="normal 36px sans-serif";ctx.textBaseline="middle";ctx.textAlign="center";ctx.strokeRect(.1*WIDTH,.45*HEIGHT,.8*WIDTH,.1*HEIGHT);ctx.fillStyle="rgba("+Config.foreGround+",1)";ctx.fillText(LANG_LOADING,WIDTH/2,HEIGHT/2);ctx.fillStyle=
b;for(a=1;a<=imagecount;a++)window["img"+a]=new Image,window["img"+a].src="images/pack"+packN+"/pack"+packN+"_"+a+".jpg",window["img"+a].onload=loadAll.onloadImg();loadingL=loadingP=0}else ctx.fillStyle="#fff",ctx.font="bold "+.04*canvas.width+"px sans-serif",ctx.textBaseline="bottom",ctx.fillText("Error: language file not found!",50,100)};loading=function(a){0===$("#pack"+packN).length?loadjs("images/pack"+packN+"/conf.js","pack"+packN):loadAll(a);$("#pack"+packN).load(function(){loadAll(a)})};
handleFileSelect=function(a){var b=a.target.files[0];if(b.type.match("image.*")||b.name.match(".ogg")||b.name.match(".mp4"))a=new FileReader,a.onload=function(a){return function(a){customGame=!0;localStorage.setItem("myimg",a.target.result);b.name.match(".ogg")?(videopuzzle=!0,$("video").get(0).pause(),$("#videosrc").attr("src",localStorage.myimg),$("video").get(0).load(),video=document.getElementById("video"),mainPage.draw()):b.name.match(".mp4")?(videopuzzle=!0,$("video").get(0).pause(),$("#videosrc").attr("src",
localStorage.myimg),$("#videosrc").attr("type","video/mp4"),$("video").get(0).load(),video=document.getElementById("video"),mainPage.draw()):(videopuzzle=!1,$("#video").get(0).pause());kep.src=localStorage.myimg;mainPage.draw()}}(b),a.readAsDataURL(b)};myDelay=function(a){2===delay?(clearTimeout(myD),object_delayed.draw(),delay=0):(delay+=1,myD=setTimeout("myDelay()",a))};
myTimer=function(a){"pause"===a&&(clearTimeout(myT),timerStarted=!1);if("challenge"!==mode){100===msecs&&(seconds+=1,msecs=0);60===seconds&&(minutes+=1,seconds=0);60===minutes&&(hours+=1,minutes=0);if("stop"===a){timerStarted=!1;hours=minutes=seconds=msecs=0;clearTimeout(myT);return}"start"===a&&(timerStarted=!0,msecs+=10,myT=setTimeout('myTimer("start")',100))}if("challenge"===mode){if("stop"===a){timerStarted=!1;hours=minutes=seconds=msecs=0;clearTimeout(myT);return}if(0===minutes&&0===seconds&&
0===msecs){clearTimeout(myT);lostPage.draw();lost=!0;return}-10===msecs&&(seconds-=1,msecs=100);-1===seconds&&(minutes-=1,seconds=59);"start"===a&&(timerStarted=!0,msecs-=10,myT=setTimeout('myTimer("start")',100))}Config.simpleMode||(ctx.clearRect(WIDTH-.15*WIDTH,0,.15*WIDTH,.065*HEIGHT),(new MyTextItem("timer",minutes+":"+seconds,WIDTH-10,.04*HEIGHT,.05*HEIGHT,0,"right")).draw())};
getMousePos=function(a,b){for(var c=a,d=0,e=0;c&&"BODY"!==c.tagName;)d+=c.offsetTop,e+=c.offsetLeft,c=c.offsetParent;return{x:b.clientX-e+window.pageXOffset,y:b.clientY-d+window.pageYOffset}};
move=function(a,b,c,d,e,f){var h=40/f*(d-b),g=40/f*(e-c),l;a.xd=b;a.yd=c;l=setInterval(function(){0<f&&(a.xd+=h,a.yd+=g,lost||repaint());f-=40;-80>=f&&(clearInterval(l),a.xd=d,a.yd=e,lost||(repaint(),repaint2()),isEnd()&&!lost?(ctx.drawImage(kep,0,0,scaledW,canvas.height),myTimer("pause"),newHigh?messagePage.draw(LANG_NEWHIGHSCORE,LANG_SOLVED+" "+moves):messagePage.draw(LANG_CONGRATS,LANG_SOLVED+" "+moves),Config.simpleMode&&(inGameButtons=new Menu,inGameButtons.add(new MenuItem("nextimg",LANG_NEXT,
scaledW/2-.2*WIDTH,.05*HEIGHT,.4*WIDTH,.13*HEIGHT,.04*HEIGHT,5)),inGameButtons.draw()),cWon||(cWon=!0,scores(),winCallback())):grid&&!lost&&(imageStroke=new MyGridItem("grid",0,0,scaledW,canvas.height,NUM,NUM),imageStroke.draw()))},40)};winCallback=function(){if(window[Config.winCallback])window[Config.winCallback](scoreCallback())};
clickCheck=function(a){var b;if(void 0!==inGameButtons&&inGameButtons.getItem(a)&&(b=inGameButtons.getItem(a).name,inGameButtons.getItem(a).name===b)){if("back"===b)for($("video").get(0).pause(),hint=!1,hintIcon=imageOff,swapHint=!1,swapIcon=imageOff,lost=!1,myTimer("stop"),mainPage.draw(),animation=!0,swaps=1,a=0;a<NUM*NUM;a++)clearTimeout(window["videoloop"+a]);if("nextimg"===b){$("video").get(0).pause();hint=!1;hintIcon=imageOff;swapHint=!1;swapIcon=imageOff;lost=!1;myTimer("stop");animation=!0;
swaps=1;for(a=0;a<NUM*NUM;a++)clearTimeout(window["videoloop"+a]);firstImage("nextimg")}else if(!isEnd()&&!lost){"timer"===b&&timerStarted&&(myTimer("pause"),messagePage.draw(LANG_PAUSED,LANG_T_CONTINUE));"animation"===b&&(animation?(animation=!1,animIcon=imageOff,animold=!1,animoldicon=imageOff):(animation=!0,animIcon=imageOn,animold=!0,animoldicon=imageOn,swapHint=!1,swapIcon=imageOff),buttonRepaint());"grid"===b&&(grid?(grid=!1,gridIcon=imageOff):(grid=!0,gridIcon=imageOn),buttonRepaint(),repaint2());
if("hint"===b){if(hint)hint=!1,hintIcon=imageOff;else{if("challenge"===mode&&seconds<hintTimePenalty&&0===minutes||"challenge"===mode&&!timerStarted)return;hint=!0;hintIcon=imageOn;"classic"===mode&&(moves+=hintMovePenalty,a=new Menu,ctx.clearRect(WIDTH-.15*WIDTH,.07*HEIGHT,.15*WIDTH,.08*HEIGHT),a.add(new MyTextItem("movesp","+"+hintMovePenalty,WIDTH-10,.1*HEIGHT,.05*HEIGHT,0,"right")),a.draw());if("challenge"==mode){ctx.clearRect(WIDTH-.15*WIDTH,0,.15*WIDTH,.065*HEIGHT);if(seconds<hintTimePenalty){seconds=
60-(hintTimePenalty-seconds);minutes-=1;return}seconds-=hintTimePenalty}}buttonRepaint();repaint2()}if("swap"==b){if("challenge"==mode){messagePage.draw(LANG_SWAP_NA,LANG_SWAP_NA2);return}0<swaps?(!1==swapHint?(swapped=!1,swapHint=!0,swapIcon=imageOn,animation=!1,animIcon=imageOff):(swapped=!0,swapHint=!1,swapIcon=imageOff,animation=animold,animIcon=animoldicon),buttonRepaint(),repaint2()):messagePage.draw(LANG_SWAP_OUT)}if("showfull"==b){if("challenge"==mode&&!timerStarted)return;fullImagePage.draw();
"classic"==mode&&(moves+=fullImageMovePenalty,a=new Menu,ctx.clearRect(WIDTH-.15*WIDTH,.07*HEIGHT,.15*WIDTH,.08*HEIGHT),a.add(new MyTextItem("movesp","+"+fullImageMovePenalty,WIDTH-10,.1*HEIGHT,.05*HEIGHT,0,"right")),a.draw())}return!0}}};$canvas.bind("click",function(a){if("game"!==activePage||clickCheck(a))return!1});isTouchDevice=function(){return document.documentElement.hasOwnProperty("ontouchstart")||document.documentElement.hasOwnProperty("onmsgesturechange")};
var mobile=isTouchDevice(),eventdown=mobile?"touchstart":"mousedown",eventup=mobile?"touchend":"mouseup";
canvas.addEventListener(eventdown,function(a){var b,c,d,e;this.getCoords=function(){if(mobile)for(e=0;e<a.touches.length;e++){if(b=a.touches[e].clientX)null!==canvas.offsetParent&&(parentOffsetLeft=canvas.offsetParent.offsetLeft,parentOffsetTop=canvas.offsetParent.offsetTop),c=a.touches[e],cx=c.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-canvas.offsetLeft-parentOffsetLeft,cy=c.clientY+document.body.scrollTop+document.documentElement.scrollTop-canvas.offsetTop-parentOffsetTop}else null!==
canvas.offsetParent&&(parentOffsetLeft=canvas.offsetParent.offsetLeft,parentOffsetTop=canvas.offsetParent.offsetTop),cx=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-canvas.offsetLeft-parentOffsetLeft,cy=a.clientY+document.body.scrollTop+document.documentElement.scrollTop-canvas.offsetTop-parentOffsetTop};if(swipe&&!swapHint){if("game"===activePage){this.getCoords();if(1===alertM)return repaint(),buttonRepaint(),alertM=0,timerStarted||isEnd()||myTimer("start"),videopuzzle&&
clearTimeout(videoendloop),!1;if(lost||isEnd()||cx>scaledW)return!1;if(-1===src)return timerStarted||myTimer("start"),src=getN(cx,cy),ctx.fillStyle="rgba("+Config.color+", 0.5)",ctx.strokeStyle="rgba("+Config.color+", 0.5)",ctx.lineWidth=.02*SIZEX,videopuzzle||(ctx.strokeStyle="rgba("+Config.color+", 0.5)",ctx.fillRect(getXYD(src).x,getXYD(src).y,SIZEX,SIZEY)),"classic"===mode&&swapped&&(animation=animold,swapped=!1),!1;if(0<=src){dst=getN(cx,cy);if(src===dst||src!==dst){repaint();if(animation){d=
new Menu;for(e=0;e<place.length;e++)d.add(new MyImageItem(e,kep,getXYS(place[e]).x,getXYS(place[e]).y,imageW,imageH,getXYD(e).x,getXYD(e).y,SIZEX,SIZEY));d.draw();!0===hint&&drawHint();!0!==grid||videopuzzle||(imageStroke=new MyGridItem("grid",0,0,scaledW,HEIGHT,NUM,NUM),imageStroke.draw())}dst=src=-1;return!1}if(neighbors(src,dst)){"classic"===mode&&swapHint&&(swaps-=1,swapHint=!1,swapIcon=imageOff,swapped=!0);"fun"!==mode&&(hint=!1,hintIcon=imageOff,buttonRepaint());!0===animation&&(sourceRect=
new MyRectItem("sourcerect",getXYD(src).x,getXYD(src).y,SIZEX,SIZEY,"rgba("+Config.backGround+", 1)"),destinationRect=new MyRectItem("destinationrect",getXYD(dst).x,getXYD(dst).y,SIZEX,SIZEY,"rgba("+Config.backGround+", 1)"),sourceImage=new MyImageItem("source",kep,getXYS(place[src]).x,getXYS(place[src]).y,imageW,imageH,getXYD(src).x,getXYD(src).y,SIZEX,SIZEY),destinationImage=new MyImageItem("destination",kep,getXYS(place[dst]).x,getXYS(place[dst]).y,imageW,imageH,getXYD(dst).x,getXYD(dst).y,SIZEX,
SIZEY),move(sourceImage,getXYD(src).x,getXYD(src).y,getXYD(dst).x,getXYD(dst).y,160),move(destinationImage,getXYD(dst).x,getXYD(dst).y,getXYD(src).x,getXYD(src).y,160));d=place[src];place[src]=place[dst];place[dst]=d;moves+=1;repaint();fakeNeighD=fakeNeighS=src=dst=-1;if(isEnd()&&!1===animation&&!lost){if(videopuzzle){for(e=0;e<NUM*NUM;e++)clearTimeout(window["videoloop"+e]);(function h(){video.paused||video.ended||(ctx.drawImage(video,0,0,scaledW,canvas.height),newHigh?messagePage.draw(LANG_NEWHIGHSCORE,
LANG_SOLVED+" "+moves):messagePage.draw(LANG_CONGRATS,LANG_SOLVED+" "+moves),videoendloop=setTimeout(h,1E3/Config.videoFPS))})()}else newHigh?messagePage.draw(LANG_NEWHIGHSCORE,LANG_SOLVED+" "+moves):messagePage.draw(LANG_CONGRATS,LANG_SOLVED+" "+moves);myTimer("pause");cWon||(cWon=!0,scores(),winCallback())}return!1}fakeNeighD=fakeNeighS=src=dst=-1;messagePage.draw(LANG_ADJACENT)}return!1}}else if("game"===activePage){this.getCoords();if(1===alertM)return repaint(),buttonRepaint(),alertM=0,timerStarted||
isEnd()||myTimer("start"),isEnd()&&videopuzzle&&clearTimeout(videoendloop),!1;if(lost||isEnd()||cx>scaledW)return!1;if(-1===src)return timerStarted||myTimer("start"),src=getN(cx,cy),ctx.fillStyle="rgba("+Config.color+",0.5)",ctx.strokeStyle="rgba("+Config.color+",0.5)",ctx.lineWidth=.02*SIZEX,videopuzzle||ctx.fillRect(getXYD(src).x,getXYD(src).y,SIZEX,SIZEY),"classic"===mode&&swapped&&(animation=animold,swapped=!1),!1;if(0<=src){dst=getN(cx,cy);if(src===dst){repaint();if(animation){d=new Menu;for(e=
0;e<place.length;e++)d.add(new MyImageItem(e,kep,getXYS(place[e]).x,getXYS(place[e]).y,imageW,imageH,getXYD(e).x,getXYD(e).y,SIZEX,SIZEY));d.draw();!0===hint&&drawHint();!0!==grid||videopuzzle||(imageStroke=new MyGridItem("grid",0,0,scaledW,HEIGHT,NUM,NUM),imageStroke.draw())}dst=src=-1;return!1}if(neighbors(src,dst)){"classic"===mode&&swapHint&&(swaps-=1,swapHint=!1,swapIcon=imageOff,swapped=!0);"fun"!==mode&&(hint=!1,hintIcon=imageOff,buttonRepaint());!0===animation&&(sourceRect=new MyRectItem("sourcerect",
getXYD(src).x,getXYD(src).y,SIZEX,SIZEY,"rgba("+Config.backGround+", 1)"),destinationRect=new MyRectItem("destinationrect",getXYD(dst).x,getXYD(dst).y,SIZEX,SIZEY,"rgba("+Config.backGround+", 1)"),sourceImage=new MyImageItem("source",kep,getXYS(place[src]).x,getXYS(place[src]).y,imageW,imageH,getXYD(src).x,getXYD(src).y,SIZEX,SIZEY),destinationImage=new MyImageItem("destination",kep,getXYS(place[dst]).x,getXYS(place[dst]).y,imageW,imageH,getXYD(dst).x,getXYD(dst).y,SIZEX,SIZEY),move(sourceImage,getXYD(src).x,
getXYD(src).y,getXYD(dst).x,getXYD(dst).y,160),move(destinationImage,getXYD(dst).x,getXYD(dst).y,getXYD(src).x,getXYD(src).y,160));d=place[src];place[src]=place[dst];place[dst]=d;moves+=1;repaint();dst=src=-1;if(isEnd()&&!1===animation&&!lost){if(videopuzzle){for(e=0;e<NUM*NUM;e++)clearTimeout(window["videoloop"+e]);(function g(){video.paused||video.ended||(ctx.drawImage(video,0,0,scaledW,canvas.height),newHigh?messagePage.draw(LANG_NEWHIGHSCORE,LANG_SOLVED+" "+moves):messagePage.draw(LANG_CONGRATS,
LANG_SOLVED+" "+moves),videoendloop=setTimeout(g,1E3/Config.videoFPS))})()}else newHigh?messagePage.draw(LANG_NEWHIGHSCORE,LANG_SOLVED+" "+moves):messagePage.draw(LANG_CONGRATS,LANG_SOLVED+" "+moves);myTimer("pause");cWon||(cWon=!0,scores(),winCallback())}return!1}src=dst=-1;messagePage.draw(LANG_ADJACENT)}return!1}});
canvas.addEventListener("touchmove",function(a){var b,c;a.preventDefault();for(c=0;c<a.touches.length;c++)if(b=a.touches[c].clientX)null!==canvas.offsetParent&&(parentOffsetLeft=canvas.offsetParent.offsetLeft,parentOffsetTop=canvas.offsetParent.offsetTop),b=a.touches[c],cx=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-canvas.offsetLeft-parentOffsetLeft,cy=b.clientY+document.body.scrollTop+document.documentElement.scrollTop-canvas.offsetTop-parentOffsetTop});
canvas.addEventListener(eventup,function(a){var b;if(swipe&&"game"===activePage&&(mobile||(null!==canvas.offsetParent&&(parentOffsetLeft=canvas.offsetParent.offsetLeft,parentOffsetTop=canvas.offsetParent.offsetTop),cx=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-canvas.offsetLeft-parentOffsetLeft,cy=a.clientY+document.body.scrollTop+document.documentElement.scrollTop-canvas.offsetTop-parentOffsetTop),!swapHint)){if(1===alertM||lost||isEnd())return!1;if(cx>scaledW)fakeNeighD=
dst=src=-1,repaint(),repaint2();else{if(-1===src)return!1;if(0<=src){dst=getN(cx,cy);if(src===dst){repaint();if(animation){a=new Menu;for(b=0;b<place.length;b++)a.add(new MyImageItem(b,kep,getXYS(place[b]).x,getXYS(place[b]).y,imageW,imageH,getXYD(b).x,getXYD(b).y,SIZEX,SIZEY));a.draw();!0===hint&&drawHint();!0!==grid||videopuzzle||(imageStroke=new MyGridItem("grid",0,0,scaledW,HEIGHT,NUM,NUM),imageStroke.draw())}fakeNeighD=fakeNeighS=dst=src=-1;return!1}if(neighbors(src,dst)){"classic"===mode&&swapHint&&
(swaps-=1,swapHint=!1,swapIcon=imageOff,swapped=!0);"fun"!==mode&&(hint=!1,hintIcon=imageOff,buttonRepaint());!0===animation&&(sourceRect=new MyRectItem("sourcerect",getXYD(fakeNeighS).x,getXYD(fakeNeighS).y,SIZEX,SIZEY,"rgba("+Config.backGround+", 1)"),destinationRect=new MyRectItem("destinationrect",getXYD(fakeNeighD).x,getXYD(fakeNeighD).y,SIZEX,SIZEY,"rgba("+Config.backGround+", 1)"),sourceImage=new MyImageItem("source",kep,getXYS(place[fakeNeighS]).x,getXYS(place[fakeNeighS]).y,imageW,imageH,
getXYD(fakeNeighS).x,getXYD(fakeNeighS).y,SIZEX,SIZEY),destinationImage=new MyImageItem("destination",kep,getXYS(place[fakeNeighD]).x,getXYS(place[fakeNeighD]).y,imageW,imageH,getXYD(fakeNeighD).x,getXYD(fakeNeighD).y,SIZEX,SIZEY),move(sourceImage,getXYD(fakeNeighS).x,getXYD(fakeNeighS).y,getXYD(fakeNeighD).x,getXYD(fakeNeighD).y,160),move(destinationImage,getXYD(fakeNeighD).x,getXYD(fakeNeighD).y,getXYD(fakeNeighS).x,getXYD(fakeNeighS).y,160));a=place[fakeNeighS];place[fakeNeighS]=place[fakeNeighD];
place[fakeNeighD]=a;moves+=1;repaint();fakeNeighD=fakeNeighS=dst=src=-1;if(isEnd()&&!1===animation){if(videopuzzle){for(b=0;b<NUM*NUM;b++)clearTimeout(window["videoloop"+b]);(function d(){video.paused||video.ended||(ctx.drawImage(video,0,0,scaledW,canvas.height),newHigh?messagePage.draw(LANG_NEWHIGHSCORE,LANG_SOLVED+" "+moves):messagePage.draw(LANG_CONGRATS,LANG_SOLVED+" "+moves),videoendloop=setTimeout(d,1E3/Config.videoFPS))})()}else newHigh?messagePage.draw(LANG_NEWHIGHSCORE,LANG_SOLVED+" "+moves):
messagePage.draw(LANG_CONGRATS,LANG_SOLVED+" "+moves);myTimer("pause");cWon||(cWon=!0,scores(),winCallback())}return!1}fakeNeighS=fakeNeighD=src=dst=-1;messagePage.draw(LANG_ADJACENT)}return!1}}});
window.onresize=function(){var a;if(Config.fullScreen)if(videopuzzle&&clearTimeout(videoendloop),WIDTH=$(window).width(),HEIGHT=$(window).height(),$ctnest.css("width",WIDTH),$ctnest.css("height",HEIGHT),$canvas.attr("width",WIDTH),$canvas.attr("height",HEIGHT),PORTRAIT=WIDTH<HEIGHT,a=.8*WIDTH,PORTRAIT&&(a=WIDTH),Config.simpleMode&&(a=WIDTH),BSIZE=.1*HEIGHT,48<BSIZE&&(BSIZE=48),videopuzzle?(imageW=video.videoWidth/NUM,imageH=video.videoHeight/NUM,kepW=Math.max(video.videoWidth,video.videoHeight),kepH=
Math.min(video.videoWidth,video.videoHeight)):(imageW=kep.width/NUM,imageH=kep.height/NUM,kepW=Math.max(kep.width,kep.height),kepH=Math.min(kep.width,kep.height)),ratio=kepW/kepH,scaledW=HEIGHT*ratio,a<scaledW&&(scaledW=a),Config.simpleMode&&(scaledW=a),SIZEX=scaledW/NUM,SIZEY=HEIGHT/NUM,PORTRAIT){if(ctx.clearRect(0,0,WIDTH,HEIGHT),messagePage.draw(LANG_WINDOW_SMALL),videopuzzle){for(a=0;a<NUM*NUM;a++)clearTimeout(window["videoloop"+a]);clearTimeout(videoendloop)}}else"main"===activePage?mainPage.draw():
"selected"===activePage?imageSelectedPage.draw():"image"===activePage?imagePage.draw():"pack"===activePage?packPage.draw():"size"===activePage?sizePage.draw():"info"===activePage?infoPage.draw():"newgame"===activePage?newGamePage.draw():"game"===activePage&&(!0===animation&&(animation=!1,animv=!0),repaint(),repaint2(),buttonRepaint(),!0===animv&&(animation=!0,animv=!1))};
langLoad=function(a,b){"ok"===b&&showMain();"error"===b&&(console.log('Note: Language file "'+a+'" is not found! The default language is loaded!'),showMain())};
confLoad=function(a,b){if("ok"===b)if(loadjs("lang/"+language+".js","lang",langLoad),$("body").append('<input class="filebrowse" type="file" id="myimage" name="myimage">'),$(".filebrowse").hide(),Config.versionCheck&&loadjs("http://darktl.com/puzzle/version.js","version"),Config.fullScreen?(WIDTH=$(window).width(),HEIGHT=$(window).height(),$ctnest.css("width",WIDTH),$ctnest.css("height",HEIGHT),$canvas.attr("width",WIDTH),$canvas.attr("height",HEIGHT),$ctnest.css({position:"fixed",top:"0",left:"0"}),
$canvas.css({position:"fixed",top:"0",left:"0"})):(WIDTH=$canvas.width(),HEIGHT=$canvas.height(),$ctnest.css("width",WIDTH),$ctnest.css("height",HEIGHT)),PORTRAIT=WIDTH<HEIGHT,maxW=.8*WIDTH,BSIZE=.1*HEIGHT,48<BSIZE&&(BSIZE=48),hintMovePenalty=Config.hintMovePenalty,hintTimePenalty=Config.hintTimePenalty,fullImageMovePenalty=Config.fullImageMovePenalty,fullImageTimePenalty=Config.fullImageTimePenalty,NUM=Config.defaultPuzzleSize,2>NUM&&(NUM=2),20<NUM&&(NUM=20),"tap"===Config.gestureStyle?(swipe=!1,
switchIcon="r"):(swipe=!0,switchIcon="l"),imagepackN=Config.packNum,confLoaded=!0,$("#ctnest").css("background","rgba("+Config.backGround+",1)"),"black"===Config.buttons?(imageOn="b",imageOff="w"):(imageOn="w",imageOff="b"),hintIcon=imageOff,gridIcon=animIcon=imageOn,showfullIcon=swapIcon=imageOff,infoIcon=nextIcon=openIcon=packIcon=imageOn,Config.quickMode&&"default"!==Config.imageForQuickMode){kep.src=Config.imageForQuickMode;if("1"==Config.quickMode){startPuzzle("classic");activePage="game";return}if("2"==
Config.quickMode){startPuzzle("challenge");activePage="game";return}if("3"==Config.quickMode){startPuzzle("fun");activePage="game";return}}else packN=Config.defaultImagePack,firstImage();"error"===b&&(console.log('Error: Connfig file "'+a+'" is not found!'),ctx.fillStyle="#fff",ctx.font="bold "+.07*canvas.width+"px sans-serif",ctx.textBaseline="bottom",ctx.fillText("Error: config.js not found!",50,100))};loadjs("config.js","config",confLoad);
function Menu(){this.objectItems=[];this.add=function(a){this.objectItems[this.objectItems.length]=a};this.draw=function(){var a;for(a=0;a<this.objectItems.length;a++)this.objectItems[a].draw()};this.getItem=function(a){null!==canvas.offsetParent&&(parentOffsetLeft=canvas.offsetParent.offsetLeft,parentOffsetTop=canvas.offsetParent.offsetTop);var b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-canvas.offsetLeft-parentOffsetLeft;a=a.clientY+document.body.scrollTop+document.documentElement.scrollTop-
canvas.offsetTop-parentOffsetTop;var c;for(c=0;c<this.objectItems.length;c++)if(this.objectItems[c].x<=b&&this.objectItems[c].x+this.objectItems[c].w>=b&&this.objectItems[c].y<=a&&this.objectItems[c].y+this.objectItems[c].h>=a)return this.objectItems[c]}}
function clickCheck(a){var b;if(void 0!==inGameButtons&&inGameButtons.getItem(a)&&(b=inGameButtons.getItem(a).name,inGameButtons.getItem(a).name===b)){if("back"===b)for($("video").get(0).pause(),hint=!1,hintIcon=imageOff,swapHint=!1,swapIcon=imageOff,lost=!1,myTimer("stop"),mainPage.draw(),animation=!0,swaps=1,a=0;a<NUM*NUM;a++)clearTimeout(window["videoloop"+a]);if("nextimg"===b){$("video").get(0).pause();hint=!1;hintIcon=imageOff;swapHint=!1;swapIcon=imageOff;lost=!1;myTimer("stop");animation=!0;
swaps=1;for(a=0;a<NUM*NUM;a++)clearTimeout(window["videoloop"+a]);firstImage("nextimg")}else if(!isEnd()&&!lost){"timer"===b&&timerStarted&&(myTimer("pause"),messagePage.draw(LANG_PAUSED,LANG_T_CONTINUE));"animation"===b&&(animation?(animation=!1,animIcon=imageOff,animold=!1,animoldicon=imageOff):(animation=!0,animIcon=imageOn,animold=!0,animoldicon=imageOn,swapHint=!1,swapIcon=imageOff),buttonRepaint());"grid"===b&&(grid?(grid=!1,gridIcon=imageOff):(grid=!0,gridIcon=imageOn),buttonRepaint(),repaint2());
if("hint"===b){if(hint)hint=!1,hintIcon=imageOff;else{if("challenge"===mode&&seconds<hintTimePenalty&&0===minutes||"challenge"===mode&&!timerStarted)return;hint=!0;hintIcon=imageOn;"classic"===mode&&(moves+=hintMovePenalty,a=new Menu,ctx.clearRect(WIDTH-.15*WIDTH,.07*HEIGHT,.15*WIDTH,.08*HEIGHT),a.add(new MyTextItem("movesp","+"+hintMovePenalty,WIDTH-10,.1*HEIGHT,.05*HEIGHT,0,"right")),a.draw());if("challenge"===mode){ctx.clearRect(WIDTH-.15*WIDTH,0,.15*WIDTH,.065*HEIGHT);if(seconds<hintTimePenalty){seconds=
60-(hintTimePenalty-seconds);minutes-=1;return}seconds-=hintTimePenalty}}buttonRepaint();repaint2()}if("swap"===b){if("challenge"===mode){messagePage.draw(LANG_SWAP_NA,LANG_SWAP_NA2);return}0<swaps?(swapHint?(swapped=!0,swapHint=!1,swapIcon=imageOff,animation=animold,animIcon=animoldicon):(swapped=!1,swapHint=!0,swapIcon=imageOn,animation=!1,animIcon=imageOff),buttonRepaint(),repaint2()):messagePage.draw(LANG_SWAP_OUT)}if("showfull"===b){if("challenge"===mode&&!timerStarted)return;fullImagePage.draw();
"classic"===mode&&(moves+=fullImageMovePenalty,a=new Menu,ctx.clearRect(WIDTH-.15*WIDTH,.07*HEIGHT,.15*WIDTH,.08*HEIGHT),a.add(new MyTextItem("movesp","+"+fullImageMovePenalty,WIDTH-10,.1*HEIGHT,.05*HEIGHT,0,"right")),a.draw())}return!0}}}
function MyTextItem(a,b,c,d,e,f,h,g){this.id=a;this.x=c;this.y=d;this.ts=e;this.shadow=f;this.align=h;this.opacity=g;this.text=b;this.draw=function(){var a=b.toString().split("\n"),k;h||(h="center");ctx.font="bold "+e+"pt sans-serif";ctx.textAlign=h;ctx.textBaseline="middle";if(0!==f&&f)for(ctx.fillStyle="rgba("+Config.color+",1)",k=0;k<a.length;k++)ctx.fillText(a[k],c+f,d+f),d+=2*e;d=this.y;ctx.fillStyle=g?"rgba("+Config.foreGround+","+g+")":"rgba("+Config.foreGround+",1)";for(k=0;k<a.length;k++)ctx.fillText(a[k],
c,d),d+=2*e;d=this.y;if(0!==f&&f)for(ctx.lineWidth=1,ctx.strokeStyle="rgba("+Config.backGround+",1)",k=0;k<a.length;k++)ctx.strokeText(a[k],c,d),d+=2*e;d=this.y}}
function MyGridItem(a,b,c,d,e,f,h,g){this.id=a;this.x=b;this.y=c;this.w=d;this.h=e;this.nx=f;this.ny=h;(this.color=g)||(g="rgba("+Config.backGround+",1)");this.draw=function(){var a;ctx.lineWidth=1;ctx.strokeStyle=g;ctx.strokeRect(b,c,d,e);ctx.strokeRect(b+d/f,c,0,e);for(a=0;a<f;a++)ctx.strokeRect(b+d/f*(f-a),c,0,e);for(a=0;a<h;a++)ctx.strokeRect(b,c+e/h*(h-a),d,0)}}
function MyRectItem(a,b,c,d,e,f){this.id=a;this.x=b;this.y=c;this.w=d;this.h=e;this.color1=f;this.draw=function(){ctx.fillStyle=f;ctx.fillRect(this.x,this.y,this.w,this.h)}}function MyStrokeItem(a,b,c,d,e,f,h){this.id=a;this.x=b;this.y=c;this.w=d;this.h=e;this.color1=f;this.line=h;this.draw=function(){ctx.strokeStyle=f;ctx.lineWidth=h;ctx.strokeRect(this.x,this.y,this.w,this.h)}}
function MyImageItem(a,b,c,d,e,f,h,g,l,k){this.id=a;this.image=b;this.xs=c;this.ys=d;this.ws=e;this.hs=f;this.xd=h;this.yd=g;this.wd=l;this.hd=k;this.draw=function(){clearTimeout(window["videoloop"+this.id]);videopuzzle?function m(){video.paused||video.ended||(ctx.drawImage(video,c,d,e,f,h,g,l,k),hint&&drawHint(),ctx.strokeRect(getXYD(src).x+.01*SIZEX,getXYD(src).y+.012*SIZEY,SIZEX-.02*SIZEX,SIZEY-.022*SIZEY),window["videoloop"+a]=setTimeout(m,1E3/Config.videoFPS))}():ctx.drawImage(this.image,this.xs,
this.ys,this.ws,this.hs,this.xd,this.yd,this.wd,this.hd)}}function VideoMenuItem(a,b,c,d,e,f){this.name=a;this.src=src;this.x=b;this.y=c;this.w=d;this.h=e;this.g=f;this.draw=function(){var a=new MyGridItem("grid",b,c,d,e,NUM,NUM,"rgba("+Config.backGround+",1)");(function l(){video.paused||video.ended||(ctx.drawImage(video,b,c,d,e),1===f&&a.draw(),videoendloop=setTimeout(l,1E3/Config.videoFPS))})()}}
function ImageMenuItem(a,b,c,d,e,f,h,g,l,k){this.name=a;this.src=b;this.x=c;this.y=d;this.w=e;this.h=f;this.lw=h;this.grid1=g;this.text=l;this.d=k;g||(this.grid1=0);this.draw=function(){var a=new Image;a.src=b;a.onload=function(){ctx.clearRect(c,d,e,f);ctx.drawImage(a,c,d,e,f);l&&(object3=new Menu,object3.add(new MyTextItem("menutext",l,c+BSIZE/2,d+BSIZE/2,.04*HEIGHT,0,"center","0.7")),object3.draw());0!==h&&(ctx.lineWidth=h,ctx.strokeStyle="rgba("+Config.foreGround+",1)",ctx.strokeRect(c,d,e,f));
1===g&&(new MyGridItem("grid",c,d,e,f,NUM,NUM,"rgba("+Config.backGround+",1)")).draw();1===k&&myDelay(100)}}}
function SizeMenuItem(a,b,c,d,e,f){this.name=a;this.x=b;this.y=c;this.w=d;this.h=e;this.size=f;this.draw=function(){var a;ctx.lineWidth=1;ctx.font="bold 18pt sans-serif";ctx.textBaseline="top";ctx.textAlign="center";ctx.fillText(f+" x "+f,b+d/2,c+e+10);ctx.fillStyle="rgba("+Config.foreGround+",1)";ctx.fillText(f+" x "+f,b+d/2,c+e+10);ctx.fillStyle="rgba("+Config.color+",1)";ctx.fillRect(b+2,c+2,d,e);ctx.fillStyle="rgba("+Config.foreGround+",1)";ctx.fillRect(b,c,d,e);ctx.strokeStyle="rgba("+Config.color+
",1)";ctx.strokeRect(b,c,d,e);ctx.strokeRect(b+d/f,c,0,e);for(a=0;a<f;a++)ctx.strokeRect(b+d/f*(f-a),c,0,e);for(a=0;a<f;a++)ctx.strokeRect(b,c+e/f*(f-a),d,0)}}
function MenuItem(a,b,c,d,e,f,h,g){this.name=a;this.text=b;this.x=c;this.y=d;this.w=e;this.h=f;this.font=h;this.radius=g;this.draw=function(){ctx.lineWidth=1.5;ctx.strokeStyle="rgba("+Config.foreGround+",1)";ctx.font="bold "+h+"pt sans-serif";ctx.textAlign="center";ctx.textBaseline="middle";var a=ctx.createLinearGradient(0,this.y,0,this.y+this.h);a.addColorStop(0,"rgba("+Config.color+",1)");a.addColorStop(1,"rgba("+Config.color2+",1)");ctx.fillStyle=a;ctx.beginPath();ctx.arc(this.x+g,this.y+g,g,Math.PI,
3*Math.PI/2,!1);ctx.lineTo(this.x+this.w-g,this.y);ctx.arc(this.x+this.w-g,this.y+g,g,3*Math.PI/2,0,!1);ctx.lineTo(this.x+this.w,this.y+this.h-g-g);ctx.arc(this.x+this.w-g,this.y+this.h-g,g,0,Math.PI/2,!1);ctx.lineTo(this.x+g,this.y+this.h);ctx.arc(this.x+g,this.y+this.h-g,g,Math.PI/2,Math.PI,!1);ctx.lineTo(this.x,this.y+g);ctx.closePath();ctx.fill();ctx.stroke();ctx.lineWidth=1;ctx.fillStyle="rgba("+Config.foreGround+",1)";ctx.fillText(this.text.toUpperCase(),this.x+this.w/2,this.y+this.h/2)}}
function MenuItemHover(a,b,c,d,e,f){this.name=a;this.x=b;this.y=c;this.w=d;this.h=e;this.draw=function(){ctx.lineWidth=1;ctx.fillStyle="rgba("+Config.foreGround+",0.3)";ctx.strokeStyle="rgba("+Config.backGround+",1)";ctx.beginPath();ctx.arc(this.x+f,this.y+f,f,Math.PI,3*Math.PI/2,!1);ctx.lineTo(this.x+this.w-f,this.y);ctx.arc(this.x+this.w-f,this.y+f,f,3*Math.PI/2,0,!1);ctx.lineTo(this.x+this.w,this.y+this.h-f-f);ctx.arc(this.x+this.w-f,this.y+this.h-f,f,0,Math.PI/2,!1);ctx.lineTo(this.x+f,this.y+
this.h);ctx.arc(this.x+f,this.y+this.h-f,f,Math.PI/2,Math.PI,!1);ctx.lineTo(this.x,this.y+f);ctx.closePath();ctx.fill();ctx.stroke()}}
function LostPage(){var a;this.draw=function(){var b;for(b=0;b<NUM*NUM;b++)clearTimeout(window["videoloop"+b]);activePage="game";ctx.fillStyle="rgba("+Config.backGround+",0.8)";ctx.fillRect(0,0,canvas.width,canvas.height);a=new Menu;a.add(new MyTextItem("timeup",LANG_TIMEISUP,scaledW/2,.4*HEIGHT,.05*WIDTH,2));a.add(new MenuItem("retry",LANG_RETRY,scaledW/2-.2*WIDTH,.05*HEIGHT,.4*WIDTH,.13*HEIGHT,.04*HEIGHT,5));a.add(new MenuItem("backm",LANG_B_MENU,scaledW/2-.2*WIDTH,.82*HEIGHT,.4*WIDTH,.13*HEIGHT,
.04*HEIGHT,5));a.draw();$canvas.unbind("click");$canvas.bind("click",function(b){if(a.getItem(b))switch(a.getItem(b).name){case "retry":hint=!1;hintIcon=imageOff;swapHint=!1;swapIcon=imageOff;lost=!1;myTimer("stop");animation=!0;swaps=1;startPuzzle("challenge");break;case "backm":hint=!1,hintIcon=imageOff,swapHint=!1,swapIcon=imageOff,lost=!1,myTimer("stop"),mainPage.draw(),animation=!0,swaps=1}})}}
function ClassiciPage(){var a;this.draw=function(){activePage="classici";ctx.fillStyle="rgba("+Config.backGround+",0.8)";ctx.fillRect(0,0,canvas.width,canvas.height);a=new Menu;a.add(new ImageMenuItem("classicim","images/classic.jpg",0,0,WIDTH,HEIGHT,0,0,"",1));a.draw();object_delayed=new Menu;object_delayed.add(new MyTextItem("i1",LANG_IC_TIMER+"\n"+LANG_I_TIMER2,.45*WIDTH,.07*HEIGHT,.018*WIDTH,0));object_delayed.add(new MyTextItem("i2",LANG_IC_EDGES+"\n"+hintMovePenalty+" "+LANG_I_MOVE_PENALTY,
.45*WIDTH,.26*HEIGHT,.018*WIDTH,0));object_delayed.add(new MyTextItem("i3",LANG_IC_SWAP,.45*WIDTH,.45*HEIGHT,.018*WIDTH,0));object_delayed.add(new MyTextItem("i4",LANG_I_FULLIMAGE+"\n"+fullImageMovePenalty+" "+LANG_I_MOVE_PENALTY,.45*WIDTH,.65*HEIGHT,.018*WIDTH,0));object_delayed.add(new MyTextItem("i5",LANG_I_GRID,.45*WIDTH,.9*HEIGHT,.018*WIDTH,0));object_delayed.add(new MyTextItem("i6",LANG_I_EXIT,.95*WIDTH,.96*HEIGHT,.018*WIDTH,0,"right"));$canvas.unbind("click");$canvas.bind("click",function(a){infoPage.draw()})}}
function ChallengeiPage(){var a;this.draw=function(){activePage="challengei";ctx.fillStyle="rgba("+Config.backGround+",0.8)";ctx.fillRect(0,0,canvas.width,canvas.height);a=new Menu;a.add(new ImageMenuItem("challengeim","images/challenge.jpg",0,0,WIDTH,HEIGHT,0,0,"",1));a.draw();object_delayed=new Menu;object_delayed.add(new MyTextItem("i1",LANG_I_TIMER+"\n"+LANG_I_TIMER2,.45*WIDTH,.07*HEIGHT,.018*WIDTH,0));object_delayed.add(new MyTextItem("i2",LANG_IC_EDGES+"\n"+hintTimePenalty+" "+LANG_I_SEC_PENALTY,
.45*WIDTH,.26*HEIGHT,.018*WIDTH,0));object_delayed.add(new MyTextItem("i3",LANG_ICH_SWAP_NA,.45*WIDTH,.45*HEIGHT,.018*WIDTH,0));object_delayed.add(new MyTextItem("i4",LANG_I_FULLIMAGE+"\n"+fullImageTimePenalty+" "+LANG_I_SEC_PENALTY,.45*WIDTH,.65*HEIGHT,.018*WIDTH,0));object_delayed.add(new MyTextItem("i5",LANG_I_GRID,.45*WIDTH,.9*HEIGHT,.018*WIDTH,0));object_delayed.add(new MyTextItem("i6",LANG_I_EXIT,.95*WIDTH,.96*HEIGHT,.018*WIDTH,0,"right"));$canvas.unbind("click");$canvas.bind("click",function(a){infoPage.draw()})}}
function FuniPage(){var a;this.draw=function(){activePage="funi";ctx.fillStyle="rgba("+Config.backGround+",0.8)";ctx.fillRect(0,0,canvas.width,canvas.height);a=new Menu;a.add(new ImageMenuItem("funim","images/fun.jpg",0,0,WIDTH,HEIGHT,0,0,"",1));a.draw();object_delayed=new Menu;object_delayed.add(new MyTextItem("i1",LANG_I_TIMER+"\n"+LANG_I_TIMER2,.45*WIDTH,.07*HEIGHT,.018*WIDTH,0));object_delayed.add(new MyTextItem("i2",LANG_I_EDGES,.45*WIDTH,.3*HEIGHT,.018*WIDTH,0));object_delayed.add(new MyTextItem("i3",
LANG_IF_SWAP,.45*WIDTH,.45*HEIGHT,.018*WIDTH,0));object_delayed.add(new MyTextItem("i4",LANG_I_FULLIMAGE,.45*WIDTH,.65*HEIGHT,.018*WIDTH,0));object_delayed.add(new MyTextItem("i5",LANG_I_GRID,.45*WIDTH,.9*HEIGHT,.018*WIDTH,0));object_delayed.add(new MyTextItem("i6",LANG_I_EXIT,.95*WIDTH,.96*HEIGHT,.018*WIDTH,0,"right"));$canvas.unbind("click");$canvas.bind("click",function(a){infoPage.draw()})}}
function PackPage(){var a;this.draw=function(){function b(){imagepacks=0;imageSizeW=canvas.width/imageNumX;imageSizeH=canvas.height/imageNumY;activePage="pack";ctx.fillStyle="rgba("+Config.backGround+",0.8)";ctx.fillRect(0,0,canvas.width,canvas.height);a=new Menu;for(d=0;d<imageNumY;d++)for(c=d*imageNumX;c<(d+1)*imageNumX;c++)imagepacks<imagepackN&&(imagepacks++,void 0!==window["Pack"+c]&&a.add(new MenuItem("pack"+c,window["Pack"+c].name,0+(c-d*imageNumX)*imageSizeW,d*imageSizeH,imageSizeW,imageSizeH,
.035*HEIGHT,5)));a.draw()}var c,d,e;videopuzzle&&($("video").get(0).pause(),clearTimeout(videoendloop));for(e=1;e<imagepackN;e++)0===$("#pack"+e).length?loadjs("images/pack"+e+"/conf.js","pack"+e):b();$("#pack"+(imagepackN-1)).load(function(){b()});$canvas.unbind("click");$canvas.bind("click",function(b){if(a.getItem(b))for(c=0;c<imagepackN;c++){if(a.getItem(b).name==="pack"+c&&"pack"===activePage){if(packN!==c){packN=c;window["Pack"+c].type&&"video"===window["Pack"+c].type?(videopuzzle=!0,imagecount=
window["Pack"+c].size):videopuzzle=!1;firstImage();loading(c);break}mainPage.draw()}}else mainPage.draw()})}}
function InfoPage(){var a;this.draw=function(){videopuzzle&&($("video").get(0).pause(),clearTimeout(videoendloop));activePage="info";ctx.fillStyle="rgba("+Config.backGround+",0.8)";ctx.fillRect(0,0,canvas.width,canvas.height);a=new Menu;a.add(new MyTextItem("title",LANG_ABOUT_TITLE,WIDTH/2,.1*HEIGHT,.03*WIDTH,0));a.add(new ImageMenuItem("icon","images/icon.png",WIDTH/2-BSIZE*WIDTH*.0015/2,.35*HEIGHT,BSIZE*WIDTH*.0015,BSIZE*WIDTH*.0015,0));a.add(new MyTextItem("about","Sliding Puzzle "+version,WIDTH/
2,.25*HEIGHT,.03*WIDTH,0));a.add(new MyTextItem("about","\u00a9 2012 Nagy D\u00e1niel P\u00e9ter - Andy1210\n e-mail: andy1210@gmail.com",WIDTH/2,.6*HEIGHT,.02*WIDTH,0));a.add(new MyTextItem("helptitle",LANG_HELP,WIDTH/2,.85*HEIGHT,.025*WIDTH,0));a.add(new MenuItem("classici",LANG_CLASSIC_M,.1*WIDTH,.9*HEIGHT,.2*WIDTH,.08*HEIGHT,.022*HEIGHT,5));a.add(new MenuItem("challengei",LANG_CHALLENGE_M,.4*WIDTH,.9*HEIGHT,.2*WIDTH,.08*HEIGHT,.022*HEIGHT,5));a.add(new MenuItem("funi",LANG_FUN_M,.7*WIDTH,.9*HEIGHT,
.2*WIDTH,.08*HEIGHT,.022*HEIGHT,5));a.draw();$canvas.unbind("click");$canvas.bind("click",function(b){if(a.getItem(b))switch(a.getItem(b).name){case "classici":classiciPage.draw();break;case "challengei":challengeiPage.draw();break;case "funi":funiPage.draw()}else mainPage.draw()})}}
function FullImagePage(){this.draw=function(){var a;if(isFullImgHint)isFullImgHint=!1;else{if(videopuzzle){for(a=0;a<NUM*NUM;a++)clearTimeout(window["videoloop"+a]);(function c(){video.paused||video.ended||(ctx.drawImage(video,0,0,scaledW,canvas.height),videoendloop=setTimeout(c,1E3/Config.videoFPS))})()}else ctx.drawImage(kep,0,0,scaledW,HEIGHT);alertM=1;showfullIcon=imageOn;buttonRepaint();isFullImgHint=!0}}}
function MessagePage(){var a;this.draw=function(b,c){this.line1=b;this.line2=c;ctx.fillStyle="rgba("+Config.backGround+",0.5)";ctx.fillRect(0,0,canvas.width,canvas.height);a=new Menu;c?(a.add(new MyTextItem("alert",b,scaledW/2,.4*HEIGHT,.03*WIDTH,0)),a.add(new MyTextItem("alert2",c,scaledW/2,.6*HEIGHT,.027*WIDTH,0))):a.add(new MyTextItem("alert",b,scaledW/2,.5*HEIGHT,.03*WIDTH,0));a.draw();alertM=1}}
function ImageSelectedPage(){var a;this.draw=function(){activePage="selected";ctx.fillStyle="rgba("+Config.backGround+",0.5)";ctx.fillRect(0,0,canvas.width,canvas.height);a=new Menu;videopuzzle?($("video").get(0).play(),a.add(new VideoMenuItem("selected",10,10,.7*WIDTH,HEIGHT-20))):a.add(new ImageMenuItem("selected","images/pack"+packN+"/pack"+packN+"_"+selectedImage+".jpg",10,10,.7*WIDTH,HEIGHT-20,5));a.add(new MenuItem("ok",LANG_SELECT,.75*WIDTH,.1*HEIGHT,.21*WIDTH,.2*HEIGHT,.05*HEIGHT,5));a.add(new MenuItem("cancel",
LANG_CANCEL,.75*WIDTH,.7*HEIGHT,.21*WIDTH,.2*HEIGHT,.05*HEIGHT,5));a.draw();$canvas.unbind("click");$canvas.bind("click",function(b){if(a.getItem(b))switch(a.getItem(b).name){case "ok":videopuzzle?($("video").get(0).pause(),clearTimeout(videoendloop)):selectImage("images/pack"+packN+"/pack"+packN+"_"+selectedImage+".jpg");mainPage.draw();customGame=!1;break;case "cancel":videopuzzle&&($("video").get(0).pause(),clearTimeout(videoendloop)),imagePage.draw()}})}}
function ImagePage(){var a;this.draw=function(){var b,c;videopuzzle&&($("video").get(0).pause(),clearTimeout(videoendloop));imageSizeW=canvas.width/imageNumX;imageSizeH=canvas.height/imageNumY;activePage="image";ctx.fillStyle="rgba("+Config.backGround+",0.5)";ctx.fillRect(0,0,canvas.width,canvas.height);(new MyTextItem("loadingi",LANG_LOADING_IMAGES,WIDTH/2,.5*HEIGHT,.03*WIDTH,0)).draw();var d=400,e=setInterval(function(){d-=40;if(0>=d){clearInterval(e);videopuzzle="video"===window["Pack"+packN].type;
images=0;a=new Menu;for(c=0;c<imageNumY;c++)for(b=c*imageNumX+1;b<(c+1)*imageNumX+1;b++)images<imagecount&&(images++,videopuzzle?(a.add(new ImageMenuItem(b,"",0+(b-1-c*imageNumX)*imageSizeW,c*imageSizeH,imageSizeW,imageSizeH,2)),a.add(new MyRectItem("rect",0+(b-1-c*imageNumX)*imageSizeW,c*imageSizeH,imageSizeW,imageSizeH,"#000")),a.add(new MyStrokeItem("stroke",0+(b-1-c*imageNumX)*imageSizeW,c*imageSizeH,imageSizeW,imageSizeH,"#fff")),a.add(new MyTextItem("title",b,0+(b-1-c*imageNumX)*imageSizeW+
imageSizeW/2,c*imageSizeH+imageSizeH/2,.05*WIDTH,0))):a.add(new ImageMenuItem(b,"images/pack"+packN+"/pack"+packN+"_"+b+".jpg",0+(b-1-c*imageNumX)*imageSizeW,c*imageSizeH,imageSizeW,imageSizeH,2)));a.add(new MenuItem("cancel",LANG_CANCEL,WIDTH-imageSizeW,HEIGHT-imageSizeH,imageSizeW,imageSizeH,.04*HEIGHT,5));a.draw()}},40);$canvas.unbind("click");$canvas.bind("click",function(c){for(b=0;b<imageNumX*imageNumY+1&&a.getItem(c);b++)if(a.getItem(c).name&&(a.getItem(c).name===b&&(selectedImage=b,"image"===
activePage&&(videopuzzle&&selectImage("images/pack"+packN+"/pack"+packN+"_"+selectedImage+".ogg"),imageSelectedPage.draw())),"cancel"===a.getItem(c).name)){mainPage.draw();break}})}}
function SizePage(){var a;this.draw=function(){var b;videopuzzle&&($("video").get(0).pause(),clearTimeout(videoendloop));activePage="size";ctx.fillStyle="rgba("+Config.backGround+",0.8)";ctx.fillRect(0,0,canvas.width,canvas.height);a=new Menu;a.add(new SizeMenuItem("2",WIDTH/5.5,HEIGHT/5,WIDTH/10,WIDTH/10,2));a.add(new SizeMenuItem("3",WIDTH/5.5*2,HEIGHT/5,WIDTH/10,WIDTH/10,3));a.add(new SizeMenuItem("4",WIDTH/5.5*3,HEIGHT/5,WIDTH/10,WIDTH/10,4));a.add(new SizeMenuItem("5",WIDTH/5.5*4,HEIGHT/5,WIDTH/
10,WIDTH/10,5));a.add(new SizeMenuItem("6",WIDTH/5.5,HEIGHT/1.8,WIDTH/10,WIDTH/10,6));a.add(new SizeMenuItem("7",WIDTH/5.5*2,HEIGHT/1.8,WIDTH/10,WIDTH/10,7));a.add(new SizeMenuItem("8",WIDTH/5.5*3,HEIGHT/1.8,WIDTH/10,WIDTH/10,8));a.add(new SizeMenuItem("9",WIDTH/5.5*4,HEIGHT/1.8,WIDTH/10,WIDTH/10,9));a.draw();$canvas.unbind("click");$canvas.bind("click",function(c){if(a.getItem(c))for(b=1;10>b;b++)if(parseInt(a.getItem(c).name,10)===b){setNUM(b);mainPage.draw();break}})}}
function NewGamePage(){var a;this.draw=function(){videopuzzle&&($("video").get(0).pause(),clearTimeout(videoendloop));Config.versionCheck&&versionCheck();ctx.fillStyle="rgba("+Config.backGround+",0.8)";ctx.fillRect(0,0,canvas.width,canvas.height);activePage="newgame";a=new Menu;a.add(new MenuItem("classic",LANG_CLASSIC,WIDTH/2-.2*WIDTH,.15*HEIGHT,.4*WIDTH,.13*HEIGHT,.04*HEIGHT,5));a.add(new MenuItem("challenge",LANG_CHALLENGE,WIDTH/2-.2*WIDTH,.3*HEIGHT,.4*WIDTH,.13*HEIGHT,.04*HEIGHT,5));a.add(new MenuItem("fun",
LANG_FUN,WIDTH/2-.2*WIDTH,.45*HEIGHT,.4*WIDTH,.13*HEIGHT,.04*HEIGHT,5));a.add(new MenuItem("cancel",LANG_CANCEL,WIDTH/2-.2*WIDTH,.7*HEIGHT,.4*WIDTH,.13*HEIGHT,.04*HEIGHT,5));a.draw();$canvas.unbind("click");$canvas.bind("click",function(b){if(a.getItem(b)&&"newgame"===activePage)switch(a.getItem(b).name){case "classic":startPuzzle("classic");activePage="game";break;case "challenge":startPuzzle("challenge");activePage="game";break;case "fun":startPuzzle("fun");activePage="game";break;case "cancel":mainPage.draw()}})}}
function MainPage(){var a,b;this.firstLoad=function(){firstImage(null,this.draw)};this.draw=function(){cWon=!1;activePage="main";ctx.clearRect(0,0,WIDTH,HEIGHT);var c=localStorage.getItem(packN+"_"+selectedImage+"_"+NUM+"_"+modeshow+"_moves"),d=localStorage.getItem(packN+"_"+selectedImage+"_"+NUM+"_"+modeshow+"_time");"classic"===modeshow&&(b=LANG_CLASSIC);"challenge"===modeshow&&(b=LANG_CHALLENGE);"fun"===modeshow&&(b=LANG_FUN);c||(d=c=LANG_NA);a=new Menu;a.add(new MyStrokeItem("selectedimagerect",
.6*WIDTH,.312*HEIGHT,.182*(WIDTH+HEIGHT),.162*HEIGHT*2.2,"rgba("+Config.color+",1)",2));videopuzzle?($("video").get(0).play(),a.add(new VideoMenuItem("selected",.6*WIDTH+3,.312*HEIGHT+3,.182*(WIDTH+HEIGHT)-6,.162*HEIGHT*2.2-6,1))):a.add(new ImageMenuItem("selectedimage",kep.src,.6*WIDTH+3,.312*HEIGHT+3,.182*(WIDTH+HEIGHT)-6,.162*HEIGHT*2.2-6,1,1));customGame||(a.add(new MyTextItem("modename",b+" "+LANG_MODE+" "+LANG_SCORES,WIDTH/1.63,.71*HEIGHT,.03*HEIGHT,0,"left")),a.add(new MyTextItem("besttime",
LANG_BEST+": ",WIDTH/1.63,.745*HEIGHT,.03*HEIGHT,0,"left")),a.add(new MyTextItem("besttime2",d,WIDTH/1.63+.15*WIDTH,.745*HEIGHT,.03*HEIGHT,0,"left")),a.add(new MyTextItem("bestmoves",LANG_MOVES+": ",WIDTH/1.63,.78*HEIGHT,.03*HEIGHT,0,"left")),a.add(new MyTextItem("bestmoves2",c,WIDTH/1.63+.15*WIDTH,.78*HEIGHT,.03*HEIGHT,0,"left")),a.add(new ImageMenuItem("next","images/next_"+nextIcon+".png",WIDTH/1.19,.735*HEIGHT,BSIZE,BSIZE,0)));a.add(new MyTextItem("title","Sliding Puzzle",WIDTH/2,.15*HEIGHT,.09*
WIDTH,2));a.add(new MenuItem("new",LANG_NEWGAME,WIDTH/2-.43*WIDTH,.32*HEIGHT,.4*WIDTH,.13*HEIGHT,.04*HEIGHT,5));a.add(new MenuItem("image",LANG_SELECT_I,WIDTH/2-.43*WIDTH,.48*HEIGHT,.4*WIDTH,.13*HEIGHT,.04*HEIGHT,5));a.add(new MenuItem("size",LANG_SELECT_S,WIDTH/2-.43*WIDTH,.64*HEIGHT,.4*WIDTH,.13*HEIGHT,.04*HEIGHT,5));a.add(new ImageMenuItem("info","images/info_"+infoIcon+".png",.2*BSIZE,HEIGHT-1.2*BSIZE,BSIZE,BSIZE,0));a.add(new MyTextItem("swipe","Swipe",WIDTH/2-1.5*BSIZE,HEIGHT-.8*BSIZE,.015*
WIDTH,0));a.add(new ImageMenuItem("switch","images/switch_"+switchIcon+".png",WIDTH/2-.3*BSIZE,HEIGHT-1.1*BSIZE,1.5*BSIZE,.7*BSIZE,0));a.add(new MyTextItem("tap","Tap",WIDTH/2+2*BSIZE,HEIGHT-.8*BSIZE,.015*WIDTH,0));a.add(new ImageMenuItem("pack","images/pack_"+packIcon+".png",WIDTH-1.2*BSIZE,HEIGHT-1.2*BSIZE,BSIZE,BSIZE,0));Config.openOwnImages&&a.add(new ImageMenuItem("open","images/open_"+openIcon+".png",WIDTH-3*BSIZE,HEIGHT-1.25*BSIZE,BSIZE,BSIZE,0));a.draw();$canvas.unbind("click");$canvas.bind("click",
function(b){if(a.getItem(b))switch(a.getItem(b).name){case "new":newGamePage.draw();break;case "size":sizePage.draw();break;case "image":imagePage.draw();break;case "info":infoPage.draw();break;case "pack":packPage.draw();break;case "open":$("#myimage").trigger("click");document.getElementById("myimage").addEventListener("change",handleFileSelect,!1);break;case "next":if("classic"===modeshow){modeshow="challenge";mainPage.draw();break}if("challenge"===modeshow){modeshow="fun";mainPage.draw();break}if("fun"===
modeshow){modeshow="classic";mainPage.draw();break}break;case "switch":"l"===switchIcon?(switchIcon="r",swipe=!1):(switchIcon="l",swipe=!0),mainPage.draw()}})}}
function firstImage(a,b){"nextimg"===a&&(videopuzzle=!1);if(videopuzzle)$("video").get(0).pause(),$("#videosrc").attr("src","images/pack"+packN+"/pack"+packN+"_1.ogg"),$("video").get(0).load(),console.log($("video").get(0)),video=document.getElementById("video");else if(confLoaded)if(0!==Config.quickMode){var c=Math.floor(Math.random()*Config.packNum);$("#randPack"+c).remove();loadjs("images/pack"+c+"/conf.js","randPack"+c);$("#randPack"+c).load(function(){var a=Math.floor(Math.random()*window["Pack"+
c].size)+1;window["Pack"+c].type&&"video"===window["Pack"+c].type?(videopuzzle=!0,$("video").get(0).pause(),$("#videosrc").attr("src","images/pack"+c+"/pack"+c+"_"+a+".ogg"),$("video").get(0).load(),video=document.getElementById("video"),videopuzzle=!0):(kep.src="images/pack"+c+"/pack"+c+"_"+a+".jpg",b&&b());1===Config.quickMode?(startPuzzle("classic"),activePage="game"):2===Config.quickMode?(startPuzzle("challenge"),activePage="game"):3===Config.quickMode&&(startPuzzle("fun"),activePage="game")})}else $("#defaultPack").remove(),
loadjs("images/pack"+packN+"/conf.js","defaultPack"),$("#defaultPack").load(function(){window["Pack"+packN].type&&"video"===window["Pack"+packN].type?(videopuzzle=!0,$("video").get(0).pause(),$("#videosrc").attr("src","images/pack"+packN+"/pack"+packN+"_1.ogg"),$("video").get(0).load(),video=document.getElementById("video"),videopuzzle=!0):(kep.src="images/pack"+packN+"/pack"+packN+"_1.jpg",b&&b())});selectedImage=1}packPage=new PackPage;lostPage=new LostPage;classiciPage=new ClassiciPage;
challengeiPage=new ChallengeiPage;funiPage=new FuniPage;infoPage=new InfoPage;newGamePage=new NewGamePage;fullImagePage=new FullImagePage;imageSelectedPage=new ImageSelectedPage;messagePage=new MessagePage;imagePage=new ImagePage;sizePage=new SizePage;mainPage=new MainPage;activePage="main";
function showMain(){1===Config.quickMode?activePage="game":2===Config.quickMode?activePage="game":3===Config.quickMode?activePage="game":PORTRAIT?(ctx.clearRect(0,0,WIDTH,HEIGHT),ctx.textAlign="center",ctx.textBaseline="middle",ctx.font="bold "+.03*WIDTH+"pt sans-serif",ctx.fillStyle="rgba("+Config.foreGround+",1)",ctx.fillText(LANG_WINDOW_SMALL,WIDTH/2,HEIGHT/2)):loadingS?loading(packN):mainPage.draw()};
