!function(e,i){"use strict";function o(){var o=this,t=i.querySelector(".js-google-promo-map");t&&(o._mapNode=t,o._mapData=s,o._createMap(),o._markers=[],o._addStyle(),o._addMarkers(),google.maps.event.addDomListenerOnce(e,"load",function(){$('img[src="'+l+'"]').parent().addClass("region-map-point").css("width","50px")}),o._map.addListener("click",function(){o.hideAll()}),t.classList.contains("js-do-not-click")||google.maps.event.addListenerOnce(o._map,"tilesloaded",function(){new google.maps.event.trigger(o._markers[0],"mouseover"),setTimeout(function(){new google.maps.event.trigger(o._markers[0],"click")},1e3)}))}function t(e){e&&$("style.map-click").remove()}var r=$("input[name=region]").data("marker").split(', ["@"]');r.pop();var a=function(){var e=[];return $.each(r,function(i,o){var t={},r=o.split(', "#');t.point=r[0].split("=>")[1].slice(1,-1),t.lat=parseFloat(r[1].split("=>")[1]),t.lng=parseFloat(r[2].split("=>")[1]),r[3].length>150?t.description=r[3].split("=>")[1].slice(1,-1).substr(0,150)+" ...":t.description=r[3].split("=>")[1].slice(1,-1),t.country=r[4].split("=>")[1].slice(1,-1),t.preview=r[6].split("=>")[1].slice(1,-1),t["inner-cards"]=[],t.path=r[5].split("=>")[1].slice(1,-1);var a=r[7].split(', ["#"]');a.pop(),$.each(a,function(e,i){var o={},r=i.split('"@');r.shift(),o.img=r[2].split("=>")[1].slice(1,-2),o.header=r[0].split("=>")[1].slice(1,-3),o.description=r[1].split("=>")[1].slice(1,-3),t["inner-cards"].push(o)}),e.push(t)}),e},s={meta:{name:"Ebash karty, bleat'!!!"},data:a()},n=['<div class="point-card js-point-card">','<a class="point-card__close js-point-card__close" href="#"></a>','<h3 class="point-card__header">{{= it.country }}</h3>','<h4 class="point-card__local-header">{{= it.point }}</h4>','<p class="point-card__local-description">{{= it.description }}</p>','<div class="scroll-area">','<div class="scroll-area__swiper-container swiper-container">','<div class="scroll-area__content swiper-wrapper">','<div class="swiper-slide">',"{{~ it['inner-cards'] :item }}",'<div class="region-preview-item">','<img src="{{= item.img }}" alt="" class="region-preview-item__image">','<h3 class="region-preview-item__header">{{= item.header }}</h3>','<p class="region-preview-item__paragraph">{{= item.description }}</p>','<div style="clear:both"></div>',"</div>","{{~}}","</div>","</div>","</div>",'<div class="swiper-scrollbar"></div>',"</div>",'<a href="{{= it.path }}" class="card-go-to">','<span class="card-go-to__text card-go-to__text--go-to">go to</span>','<span class="card-go-to__text">{{= it.point}}</span>',"</a>","</div>"].join(""),p=doT.compile(n),l="/assets/img/map/map-point.svg";o.prototype._createMap=function(){var e=this,o=i.querySelector(".js-google-promo-map"),t=[{featureType:"all",elementType:"geometry",stylers:[{color:"#95CC72"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{color:"#f5f5f5"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#C5F4FE"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#f5f5f5"},{weight:.5}]},{featureType:"administrative_area_level_1",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"administrative.country",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]}],r=new google.maps.StyledMapType(t,{name:"Styled Map"}),a=new google.maps.Map(o,{zoom:$("input[name=region]").data("zoom"),center:e._mapData.data[0],draggable:!1,scrollwheel:!1,zoomControl:!1});a.mapTypes.set("map_style",r),a.setMapTypeId("map_style"),e._map=a},o.prototype.hideAll=function(){var e=this;e._markers.forEach(function(e){e.set("icon",l)}),$(".map-point-clicked").removeClass("map-point-clicked"),e.hideCard()},o.prototype._addStyle=function(){var e=i.createElement("style"),o=this._mapData.data;e.innerText=o.map(function(e){return'img[src="'+e.preview+'"]'}).join(", ")+" { border-radius: 50%; filter: grayscale(100%); border: 4px solid #fff !important; opacity: 0!important; display: block !important; } ",e.innerText+=o.map(function(e){return'img[src="'+e.preview+'"] + .region-map-point__title'}).join(", ")+" { display: block; } ",i.head.appendChild(e)},o.prototype.showCard=function(e){var i,o=this,t=o._mapData.data,r={};o.hideCard(),t.every(function(i){return i.point===e?(r=i,!1):!0}),i=p(r),$(".js-promo-map").append(i).find(".js-point-card__close").on("click",function(e){e.preventDefault(),o.hideAll()});var a=$(".js-point-card").get(0);if(a){var s=new TimelineLite;s.from(a,1,{top:-100,opacity:0,force3D:!0})}var n=$(".js-point-card .region-preview-item");$(".js-point-card .swiper-slide").height(n.length*(n.height()+10));new Swiper(".js-point-card .swiper-container",{scrollbar:".swiper-scrollbar",direction:"vertical",slidesPerView:"auto",mousewheelControl:!0,freeMode:!0})},o.prototype.hideCard=function(){var e=$(".js-point-card").get(0);if(e){e.classList.remove("js-point-card");var i=new TimelineLite({onComplete:function(){e.parentNode.removeChild(e)}});i.to(e,1,{top:100,opacity:0,force3D:!0})}},o.prototype._addMarker=function(i){var o=this,r=o._mapNode,a=o._map,s=new google.maps.Marker({position:{lat:i.lat,lng:i.lng},draggable:!1,icon:l,optimized:!1,title:i.point});return google.maps.event.addDomListener(s,"mouseover",function(){s.set("icon",i.preview),$(".google-promo-map .img-circle:not(.gmnoprint), .google-promo-map .img-circle").removeClass("hover"),t(!0),e.util.waitFor(function(){return $('img[src="'+i.preview+'"]',r).length}).then(function(){$('img[src="'+i.preview+'"]',r).each(function(){var e=$(this).parent();e.addClass("hover"),e.find(".region-map-point__title").length||e.append('<span class="region-map-point__title">'+i.point+"</span>")})})["catch"](function(){console.log("can not load img")}),$('img[src="'+i.preview+'"]').parent().each(function(){$(this).css({"background-image":"url("+i.preview+")","background-size":"cover"})}),$(".google-promo-map .img-circle:not(.gmnoprint), .google-promo-map .img-circle").css({border:"4px solid #fff !important"})}),google.maps.event.addDomListener(s,"mouseout",function(){var e=$('img[src="'+i.preview+'"]');e.parent().hasClass("map-point-clicked")||(s.set("icon",l),t(!0),e.parent().hasClass("map-point-clicked")||($(".google-promo-map .img-circle:not(.gmnoprint), .google-promo-map .img-circle").removeClass("hover"),$('img[src="'+i.preview+'"]').parent().each(function(){$(this).addClass("img-circle").removeClass("hover").css({"background-image":"url("+i.preview+")","background-size":"cover"})})))}),google.maps.event.addDomListener(s,"click",function(){t(!0),o.hideAll(),s.set("icon",i.preview),o.showCard(s.title),$('img[src="'+i.preview+'"]').parent().each(function(){$(this).addClass("map-point-clicked img-circle").css({"background-image":"url("+i.preview+")","background-size":"cover"})}),$(".google-promo-map .map-point-clicked.img-circle:not(.gmnoprint)").css({"border-color":"#6cb7ca"}),$("a.point-card__close.js-point-card__close").click(function(){$(".google-promo-map .img-circle:not(.gmnoprint), .google-promo-map .img-circle").removeClass("hover")})}),s.setMap(a),s},o.prototype._addMarkers=function(){var e=this,i=e._mapData;this._markers=i.data.map(e._addMarker,this)},e.onload=function(){new o},$(".js-google-promo-map").click(function(){$(".google-promo-map .img-circle:not(.gmnoprint), .google-promo-map .img-circle").removeClass("hover")})}(window,window.document);